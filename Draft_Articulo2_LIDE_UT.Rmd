---
title: "Uso del tiempo de los ecuatorianos 2"
author: "Christian Javier Salas Marquez"
date: "Marzo de 2022"
output: html_notebook
---

Work in progress

Last edited: 07-04-2022

En este script se busca comparar los resultados de la pregunta: En la semana pasada... ¿Hizo ejercicios o practicó algún deporte?
Tanto en la encuesta de uso del tiempo del 2012 como en la encuesta nacional multipropósito del 2020 se encuentra esta pregunta.


```{r include=FALSE}
###############################################################
####                   Librerias                           ####
###############################################################

if(!require(tidyverse)) install.packages("tidyverse", repos = "http://cran.us.r-project.org")
if(!require(haven)) install.packages("haven", repos = "http://cran.us.r-project.org")
if(!require(readr)) install.packages("readr", repos = "http://cran.us.r-project.org")
if(!require(radiant.data)) install.packages("radiant.data", repos = "http://cran.us.r-project.org")
if(!require(gridExtra)) install.packages("gridExtra", repos = "http://cran.us.r-project.org")
if(!require(grid)) install.packages("grid", repos = "http://cran.us.r-project.org")


```

```{r include=FALSE}
###############################################################
####                   Descargar los datos                 ####
###############################################################


# Base de datos 
# Le damos un nombre al url
url <- "https://github.com/christianjaviersalasmarquez/LIDE_ESPOL_Christian_Salas/raw/main/Base%20EUT%202012.zip"
# Creamos un directorio temporal
td <- tempdir()
# Creamos una carpeta temporal
tf <- tempfile(tmpdir=td, fileext = ".zip")
# Descargamos los discap en la carpeta temporal
download.file(url,tf)

```

```{r include=FALSE}
# Obtenemos el nombre del archivo dentro del archivo zip, lo descomprimimos (unzip), obtenemos el nombre del 
# parche, y finalmente lo cargamos
EUT2012.f.name <- unzip(tf, list=TRUE)$Name[1] # El archivo SAV de la EUT 2012 es el primero
unzip(tf, files=EUT2012.f.name, exdir=td, overwrite=TRUE)
EUT2012.f.path <- file.path(td, EUT2012.f.name)
uso_del_tiempo_2012 <- read_sav(EUT2012.f.path)
```

```{r include=FALSE}
data_UT2012 <- data.frame(uso_del_tiempo_2012)
```

```{r include=FALSE}
educacion_actfisica_tics_2020 <- read.csv2("https://raw.githubusercontent.com/christianjaviersalasmarquez/LIDE_ESPOL_Christian_Salas/main/202012_multibdd_educaci%C3%B3n_actfisica_tics.csv", header = FALSE)
```

```{r include=FALSE}
personas_2020 <- read.csv2("https://raw.githubusercontent.com/christianjaviersalasmarquez/LIDE_ESPOL_Christian_Salas/main/202012_multibdd_personas.csv", header = FALSE)
```

```{r include=FALSE}
header_true <- function(df) {
  names(df) <- as.character(unlist(df[1,]))
  df[-1,]
}
```

```{r include=FALSE}
data_EDUCACION_ACTFISICA_TICS2020 <- header_true(educacion_actfisica_tics_2020)

colnames(data_EDUCACION_ACTFISICA_TICS2020)[1] <- 'area'
```

```{r include=FALSE}
data_personas2020 <- header_true(personas_2020)

colnames(data_personas2020)[1] <- 'area'
```




# 2012

```{r}
###############################################################
####                        2012                           ####
###############################################################
# UT111: En la semana pasada... ¿Hizo ejercicios o practicó algún deporte?

df_analisis_UT111_UT2012 <- data.frame(P02_factor = fct_recode(factor(data_UT2012$P02), "Hombre" = "1", "Mujer"="2") , CIUDAD = data_UT2012$CIUDAD, UT111 = data_UT2012$UT111 , UT111_factor = fct_recode(factor(data_UT2012$UT111), "Si"="1","No"="2" ), P03 = data_UT2012$P03 , UT111A = data_UT2012$UT111A, UT111B = data_UT2012$UT111B, UT111C = data_UT2012$UT111C, UT111D = data_UT2012$UT111D, fexp_UT2012 = data_UT2012$fexp )

```

```{r}
# Rango de edades 2012

edad_2012 <- as.numeric(df_analisis_UT111_UT2012$P03)

# 98: 98 y más
# 99: No informa

R_edad_2012 = length(edad_2012)
rango_edad_10_UT2012 <- rep(0,R_edad_2012)

for (i in 1:R_edad_2012) {
  if((edad_2012[i] >= 0 ) & (edad_2012[i] <= 11)) { rango_edad_10_UT2012[i] <- 'Edad entre 0 y 11 años' }
  else if ( (edad_2012[i] >=12  ) & (edad_2012[i] <= 19  ) ) { rango_edad_10_UT2012[i] <- 'Edad entre 12 y 19 años' }
  else if ( (edad_2012[i] >=20  ) & (edad_2012[i] <= 29  ) ) { rango_edad_10_UT2012[i] <- 'Edad entre 20 y 29 años' }
  else if ( (edad_2012[i] >=30  ) & (edad_2012[i] <= 39  ) ) { rango_edad_10_UT2012[i] <- 'Edad entre 30 y 39 años' }
  else if ( (edad_2012[i] >=40  ) & (edad_2012[i] <= 49  ) ) { rango_edad_10_UT2012[i] <- 'Edad entre 40 y 49 años' }
  else if ( (edad_2012[i] >=50  ) & (edad_2012[i] <= 59  ) ) { rango_edad_10_UT2012[i] <- 'Edad entre 50 y 59 años' }
  else if ( (edad_2012[i] >=60  ) & (edad_2012[i] <= 69  ) ) { rango_edad_10_UT2012[i] <- 'Edad entre 60 y 69 años' }
  else if ( (edad_2012[i] >=70  ) & (edad_2012[i] <= 98  )) { rango_edad_10_UT2012[i] <- 'Edad mayor a 70 años' }
  else if ( edad_2012[i] == 99  ) { rango_edad_10_UT2012[i] <- 'No informa' }
}

df_analisis_UT111_UT2012$rango_edad_10_UT2012 <- factor(rango_edad_10_UT2012)
```



```{r}
codigo_ciudad_2012 <- as.character(df_analisis_UT111_UT2012$CIUDAD)

R_provincia_2012 <- length(codigo_ciudad_2012)
provincia_UT2012 <- rep(0, R_provincia_2012)

for (i in 1:R_provincia_2012) {
  if (nchar(codigo_ciudad_2012[i]) == 5 ) {
    codigo_ciudad_2012[i] <- paste("0",codigo_ciudad_2012[i], sep = "")
  }
}


for (i in 1:R_provincia_2012) {
  
  if (substr(codigo_ciudad_2012[i], start = 1, stop = 2) == "01") { provincia_UT2012[i] <- 'Azuay' }
  else if (substr(codigo_ciudad_2012[i], start = 1, stop = 2) == "02") { provincia_UT2012[i] <- 'Bolívar' }
  else if (substr(codigo_ciudad_2012[i], start = 1, stop = 2) == "03") { provincia_UT2012[i] <- 'Cañar' }
  else if (substr(codigo_ciudad_2012[i], start = 1, stop = 2) == "04") { provincia_UT2012[i] <- 'Carchi' }
  else if (substr(codigo_ciudad_2012[i], start = 1, stop = 2) == "05") { provincia_UT2012[i] <- 'Cotopaxi' }
  else if (substr(codigo_ciudad_2012[i], start = 1, stop = 2) == "06") { provincia_UT2012[i] <- 'Chimborazo' }
  else if (substr(codigo_ciudad_2012[i], start = 1, stop = 2) == "07") { provincia_UT2012[i] <- 'El Oro' }
  else if (substr(codigo_ciudad_2012[i], start = 1, stop = 2) == "08") { provincia_UT2012[i] <- 'Esmeraldas' }
  else if (substr(codigo_ciudad_2012[i], start = 1, stop = 2) == "09") { provincia_UT2012[i] <- 'Guayas' }
  else if (substr(codigo_ciudad_2012[i], start = 1, stop = 2) == "10") { provincia_UT2012[i] <- 'Imbabura' }
  else if (substr(codigo_ciudad_2012[i], start = 1, stop = 2) == "11") { provincia_UT2012[i] <- 'Loja' }
  else if (substr(codigo_ciudad_2012[i], start = 1, stop = 2) == "12") { provincia_UT2012[i] <- 'Los Ríos' }
  else if (substr(codigo_ciudad_2012[i], start = 1, stop = 2) == "13") { provincia_UT2012[i] <- 'Manabí' }
  else if (substr(codigo_ciudad_2012[i], start = 1, stop = 2) == "14") { provincia_UT2012[i] <- 'Morona Santiago' }
  else if (substr(codigo_ciudad_2012[i], start = 1, stop = 2) == "15") { provincia_UT2012[i] <- 'Napo' }
  else if (substr(codigo_ciudad_2012[i], start = 1, stop = 2) == "16") { provincia_UT2012[i] <- 'Pastaza' }
  else if (substr(codigo_ciudad_2012[i], start = 1, stop = 2) == "17") { provincia_UT2012[i] <- 'Pichincha' }
  else if (substr(codigo_ciudad_2012[i], start = 1, stop = 2) == "18") { provincia_UT2012[i] <- 'Tungurahua' }
  else if (substr(codigo_ciudad_2012[i], start = 1, stop = 2) == "19") { provincia_UT2012[i] <- 'Zamora Chinchipe' }
  else if (substr(codigo_ciudad_2012[i], start = 1, stop = 2) == "20") { provincia_UT2012[i] <- 'Galápagos' } 
  else if (substr(codigo_ciudad_2012[i], start = 1, stop = 2) == "21") { provincia_UT2012[i] <- 'Sucumbíos' }
  else if (substr(codigo_ciudad_2012[i], start = 1, stop = 2) == "22") { provincia_UT2012[i] <- 'Orellana' }
  else if (substr(codigo_ciudad_2012[i], start = 1, stop = 2) == "23") { provincia_UT2012[i] <- 'Santo Domingo de los Tsáchilas' }
  else if (substr(codigo_ciudad_2012[i], start = 1, stop = 2) == "24") { provincia_UT2012[i] <- 'Santa Elena' }
  else if (substr(codigo_ciudad_2012[i], start = 1, stop = 2) == "90") { provincia_UT2012[i] <- 'Zonas no delimitadas' }
  
}

df_analisis_UT111_UT2012$provincia_UT2012 <- factor(provincia_UT2012)
```


```{r}
###############################################################
####                Cálculos UT111 2012                    ####
###############################################################

# df_UT111_ABCD_UT2012 es un data frame auxiliar para calcular la cantidad horas_semanales_deporte

df_UT111_ABCD_UT2012 <- data.frame( UT111A = data_UT2012$UT111A, UT111B = data_UT2012$UT111B, UT111C = data_UT2012$UT111C, UT111D = data_UT2012$UT111D  )

df_UT111_ABCD_UT2012[is.na(df_UT111_ABCD_UT2012)] <- 0

df_analisis_UT111_UT2012$horas_semanales_deporte <- df_UT111_ABCD_UT2012$UT111A + (df_UT111_ABCD_UT2012$UT111B/60) + df_UT111_ABCD_UT2012$UT111C + (df_UT111_ABCD_UT2012$UT111D/60)

```


```{r}
df_t_deporte_UT2012_plot1 <-  df_analisis_UT111_UT2012 %>%
  filter( UT111_factor == "Si" | UT111_factor == "No" ) %>%
  group_by(P02_factor) %>%
  summarize( 
    media_ponderada_horas_deporte = weighted.mean(horas_semanales_deporte, fexp_UT2012), 
    sd_ponderada = weighted.sd(horas_semanales_deporte, fexp_UT2012),
    promedio_horas_deporte = mean(horas_semanales_deporte), 
    sd = sd(horas_semanales_deporte), 
    suma = sum(horas_semanales_deporte), 
    max = max(horas_semanales_deporte), 
    min = min(horas_semanales_deporte))


df_t_deporte_UT2012_plot1
```


```{r}
df_t_deporte_UT2012_plot2 <-  df_analisis_UT111_UT2012 %>%
  filter( UT111_factor == "Si" | UT111_factor == "No" ) %>%
  group_by(rango_edad_10_UT2012) %>%
  summarize( 
    media_ponderada_horas_deporte = weighted.mean(horas_semanales_deporte, fexp_UT2012), 
    sd_ponderada = weighted.sd(horas_semanales_deporte, fexp_UT2012),
    promedio_horas_deporte = mean(horas_semanales_deporte), 
    sd = sd(horas_semanales_deporte), 
    suma = sum(horas_semanales_deporte), 
    max = max(horas_semanales_deporte), 
    min = min(horas_semanales_deporte))


df_t_deporte_UT2012_plot2
```

```{r}
df_t_deporte_UT2012_plot3 <-  df_analisis_UT111_UT2012 %>%
  filter( UT111_factor == "Si" | UT111_factor == "No" ) %>%
  group_by(rango_edad_10_UT2012, P02_factor) %>%
  summarize( 
    media_ponderada_horas_deporte = weighted.mean(horas_semanales_deporte, fexp_UT2012), 
    sd_ponderada = weighted.sd(horas_semanales_deporte, fexp_UT2012),
    promedio_horas_deporte = mean(horas_semanales_deporte), 
    sd = sd(horas_semanales_deporte), 
    suma = sum(horas_semanales_deporte), 
    max = max(horas_semanales_deporte), 
    min = min(horas_semanales_deporte))


df_t_deporte_UT2012_plot3
```

```{r}
df_t_deporte_UT2012_plot4 <-  df_analisis_UT111_UT2012 %>%
  filter( UT111_factor == "Si" | UT111_factor == "No" ) %>%
  group_by(provincia_UT2012) %>%
  summarize( 
    media_ponderada_horas_deporte = weighted.mean(horas_semanales_deporte, fexp_UT2012), 
    sd_ponderada = weighted.sd(horas_semanales_deporte, fexp_UT2012),
    promedio_horas_deporte = mean(horas_semanales_deporte), 
    sd = sd(horas_semanales_deporte), 
    suma = sum(horas_semanales_deporte), 
    max = max(horas_semanales_deporte), 
    min = min(horas_semanales_deporte))


df_t_deporte_UT2012_plot4
```

```{r}
df_t_deporte_UT2012_plot5 <-  df_analisis_UT111_UT2012 %>%
  filter( UT111_factor == "Si" | UT111_factor == "No" ) %>%
  group_by(provincia_UT2012, P02_factor) %>%
  summarize( 
    media_ponderada_horas_deporte = weighted.mean(horas_semanales_deporte, fexp_UT2012), 
    sd_ponderada = weighted.sd(horas_semanales_deporte, fexp_UT2012),
    promedio_horas_deporte = mean(horas_semanales_deporte), 
    sd = sd(horas_semanales_deporte), 
    suma = sum(horas_semanales_deporte), 
    max = max(horas_semanales_deporte), 
    min = min(horas_semanales_deporte))


df_t_deporte_UT2012_plot5
```



# 2020


```{r include=FALSE}
###############################################################
####                        2020                           ####
###############################################################

df_info_personas2020 <- data.frame(id_per = data_personas2020$id_per, s1p2 = data_personas2020$s1p2)

df_analisis_UT2020 <- merge(df_info_personas2020, data_EDUCACION_ACTFISICA_TICS2020, by = "id_per")
```

Se debe considerar también el tiempo de respuesta de los que responden que NO hicieron actividad física o deporte en la semana pasada, lo que implica que el encuestado realizó 0 horas de deporte, lo cual también influye en el promedio y debe considerarse.

```{r}
# df_analisis_UT2020_s6p4 es un data frame auxiliar para calcular la cantidad horas_semanales_deporte

df_analisis_UT2020_s6p4 <- data.frame( s6p4a = as.numeric(df_analisis_UT2020$s6p4a), s6p4b =  as.numeric(df_analisis_UT2020$s6p4b), s6p4c = as.numeric(df_analisis_UT2020$s6p4c), s6p4d = as.numeric(df_analisis_UT2020$s6p4d))


df_analisis_UT2020_s6p4[is.na(df_analisis_UT2020_s6p4)] <- 0


df_analisis_UT2020$horas_semanales_deporte <- df_analisis_UT2020_s6p4$s6p4a + (df_analisis_UT2020_s6p4$s6p4b/60) + df_analisis_UT2020_s6p4$s6p4c + (df_analisis_UT2020_s6p4$s6p4d/60)
```

```{r}
df_analisis_UT2020$s1p2_factor <- fct_recode(factor(df_analisis_UT2020$s1p2), "Hombre"="1","Mujer"="2" )
df_analisis_UT2020$s6p4_factor <- fct_recode(factor(df_analisis_UT2020$s6p4), "Si"="1","No"="2" ) 
```


```{r}
# En el dataset, fexp está compuesta por valores del tipo character con coma, por lo cual R no puede transformar a numeric sin que aparezca el warning NAs introduced by coercion transformando todos los valores en NA. Primero es necesario reemplazar las comas por puntos

R_fexp_2020 <- length(df_analisis_UT2020$fexp)
fexp_UT2020 <- rep(0,R_fexp_2020)

for (i in 1:R_fexp_2020) {
  fexp_UT2020[i] <- gsub(",",".", df_analisis_UT2020$fexp[i])
}

df_analisis_UT2020$fexp_UT2020 <- as.numeric(fexp_UT2020)
```


```{r}
# Rango de edades 

edad_2020 <- as.numeric(df_analisis_UT2020$s1p3)

R = length(edad_2020)
rango_edad_10_UT2020 <- rep(0,R)

for (i in 1:R) {
  if((edad_2020[i] >= 0 ) & (edad_2020[i] <= 11)) { rango_edad_10_UT2020[i] <- 'Edad entre 0 y 11 años' }
  else if ( (edad_2020[i] >=12  ) & (edad_2020[i] <= 19  ) ) { rango_edad_10_UT2020[i] <- 'Edad entre 12 y 19 años' }
  else if ( (edad_2020[i] >=20  ) & (edad_2020[i] <= 29  ) ) { rango_edad_10_UT2020[i] <- 'Edad entre 20 y 29 años' }
  else if ( (edad_2020[i] >=30  ) & (edad_2020[i] <= 39  ) ) { rango_edad_10_UT2020[i] <- 'Edad entre 30 y 39 años' }
  else if ( (edad_2020[i] >=40  ) & (edad_2020[i] <= 49  ) ) { rango_edad_10_UT2020[i] <- 'Edad entre 40 y 49 años' }
  else if ( (edad_2020[i] >=50  ) & (edad_2020[i] <= 59  ) ) { rango_edad_10_UT2020[i] <- 'Edad entre 50 y 59 años' }
  else if ( (edad_2020[i] >=60  ) & (edad_2020[i] <= 69  ) ) { rango_edad_10_UT2020[i] <- 'Edad entre 60 y 69 años' }
  else if ( (edad_2020[i] >=70  )) { rango_edad_10_UT2020[i] <- 'Edad mayor a 70 años' }
}

df_analisis_UT2020$rango_edad_10_UT2020 <- factor(rango_edad_10_UT2020)
```


```{r}
codigo_ciudad_2020 <- as.character(df_analisis_UT2020$ciudad)


R_provincia_2020 <- length(codigo_ciudad_2020)
provincia_UT2020 <- rep(0, R_provincia_2020)

for (i in 1:R_provincia_2020) {
  if (nchar(codigo_ciudad_2020[i]) == 5 ) {
    codigo_ciudad_2020[i] <- paste("0",codigo_ciudad_2020[i], sep = "")
  }
}




for (i in 1:R_provincia_2020) {
  
  if (substr(codigo_ciudad_2020[i], start = 1, stop = 2) == "01") { provincia_UT2020[i] <- 'Azuay' }
  else if (substr(codigo_ciudad_2020[i], start = 1, stop = 2) == "02") { provincia_UT2020[i] <- 'Bolívar' }
  else if (substr(codigo_ciudad_2020[i], start = 1, stop = 2) == "03") { provincia_UT2020[i] <- 'Cañar' }
  else if (substr(codigo_ciudad_2020[i], start = 1, stop = 2) == "04") { provincia_UT2020[i] <- 'Carchi' }
  else if (substr(codigo_ciudad_2020[i], start = 1, stop = 2) == "05") { provincia_UT2020[i] <- 'Cotopaxi' }
  else if (substr(codigo_ciudad_2020[i], start = 1, stop = 2) == "06") { provincia_UT2020[i] <- 'Chimborazo' }
  else if (substr(codigo_ciudad_2020[i], start = 1, stop = 2) == "07") { provincia_UT2020[i] <- 'El Oro' }
  else if (substr(codigo_ciudad_2020[i], start = 1, stop = 2) == "08") { provincia_UT2020[i] <- 'Esmeraldas' }
  else if (substr(codigo_ciudad_2020[i], start = 1, stop = 2) == "09") { provincia_UT2020[i] <- 'Guayas' }
  else if (substr(codigo_ciudad_2020[i], start = 1, stop = 2) == "10") { provincia_UT2020[i] <- 'Imbabura' }
  else if (substr(codigo_ciudad_2020[i], start = 1, stop = 2) == "11") { provincia_UT2020[i] <- 'Loja' }
  else if (substr(codigo_ciudad_2020[i], start = 1, stop = 2) == "12") { provincia_UT2020[i] <- 'Los Ríos' }
  else if (substr(codigo_ciudad_2020[i], start = 1, stop = 2) == "13") { provincia_UT2020[i] <- 'Manabí' }
  else if (substr(codigo_ciudad_2020[i], start = 1, stop = 2) == "14") { provincia_UT2020[i] <- 'Morona Santiago' }
  else if (substr(codigo_ciudad_2020[i], start = 1, stop = 2) == "15") { provincia_UT2020[i] <- 'Napo' }
  else if (substr(codigo_ciudad_2020[i], start = 1, stop = 2) == "16") { provincia_UT2020[i] <- 'Pastaza' }
  else if (substr(codigo_ciudad_2020[i], start = 1, stop = 2) == "17") { provincia_UT2020[i] <- 'Pichincha' }
  else if (substr(codigo_ciudad_2020[i], start = 1, stop = 2) == "18") { provincia_UT2020[i] <- 'Tungurahua' }
  else if (substr(codigo_ciudad_2020[i], start = 1, stop = 2) == "19") { provincia_UT2020[i] <- 'Zamora Chinchipe' }
  else if (substr(codigo_ciudad_2020[i], start = 1, stop = 2) == "20") { provincia_UT2020[i] <- 'Galápagos' } 
  else if (substr(codigo_ciudad_2020[i], start = 1, stop = 2) == "21") { provincia_UT2020[i] <- 'Sucumbíos' }
  else if (substr(codigo_ciudad_2020[i], start = 1, stop = 2) == "22") { provincia_UT2020[i] <- 'Orellana' }
  else if (substr(codigo_ciudad_2020[i], start = 1, stop = 2) == "23") { provincia_UT2020[i] <- 'Santo Domingo de los Tsáchilas' }
  else if (substr(codigo_ciudad_2020[i], start = 1, stop = 2) == "24") { provincia_UT2020[i] <- 'Santa Elena' }
  else if (substr(codigo_ciudad_2020[i], start = 1, stop = 2) == "90") { provincia_UT2020[i] <- 'Zonas no delimitadas' }
  
}

df_analisis_UT2020$provincia_UT2020 <- factor(provincia_UT2020)
```


```{r}
###############################################################
####                Cálculos 2020                     ####
###############################################################

# Cuanto tiempo...? Promedio de horas semanales deporte, por sexo. Considerando tanto a los que respondieron que si como los que respondieron que no.


df_t_deporte_UT2020_plot1 <-  df_analisis_UT2020 %>%
  filter( s6p4_factor == "Si" | s6p4_factor == "No" ) %>% # NECESARIO
  group_by(s1p2_factor) %>%
  summarize( 
    promedio_horas_deporte = mean(horas_semanales_deporte), 
    media_ponderada_horas_deporte = weighted.mean(horas_semanales_deporte, fexp_UT2020), 
    sd = sd(horas_semanales_deporte), 
    sd_ponderada_1 = weighted.sd(horas_semanales_deporte, fexp_UT2020),
    sd_ponderada_2 = sqrt(sum(fexp_UT2020*((horas_semanales_deporte - weighted.mean(horas_semanales_deporte, fexp_UT2020) )^2))/(sum(fexp_UT2020)-1)),
    suma = sum(horas_semanales_deporte), 
    max = max(horas_semanales_deporte), 
    min = min(horas_semanales_deporte)  )

df_t_deporte_UT2020_plot1

```


```{r}
# VALIDACION

#View(data.frame(df_analisis_UT2020$s1p3, df_analisis_UT2020$s6p4_factor)) #Los NA corresponden a personas menores a 12, es necesario el filtro.
```


```{r}
df_t_deporte_UT2020_plot2 <-  df_analisis_UT2020 %>%
  filter( s6p4_factor == "Si" | s6p4_factor == "No" ) %>% 
  group_by(rango_edad_10_UT2020) %>%
  summarize( 
    media_ponderada_horas_deporte = weighted.mean(horas_semanales_deporte, fexp_UT2020), 
    sd_ponderada = weighted.sd(horas_semanales_deporte, fexp_UT2020),
    promedio_horas_deporte = mean(horas_semanales_deporte), 
    sd = sd(horas_semanales_deporte), 
    suma = sum(horas_semanales_deporte), 
    max = max(horas_semanales_deporte), 
    min = min(horas_semanales_deporte))

df_t_deporte_UT2020_plot2
```


```{r}
df_t_deporte_UT2020_plot3 <-  df_analisis_UT2020 %>%
  filter( s6p4_factor == "Si" | s6p4_factor == "No" ) %>% 
  group_by(rango_edad_10_UT2020, s1p2_factor) %>%
  summarize( 
    media_ponderada_horas_deporte = weighted.mean(horas_semanales_deporte, fexp_UT2020), 
    sd_ponderada = weighted.sd(horas_semanales_deporte, fexp_UT2020),
    promedio_horas_deporte = mean(horas_semanales_deporte), 
    sd = sd(horas_semanales_deporte), 
    suma = sum(horas_semanales_deporte), 
    max = max(horas_semanales_deporte), 
    min = min(horas_semanales_deporte))

df_t_deporte_UT2020_plot3
```


```{r}
df_t_deporte_UT2020_plot4 <-  df_analisis_UT2020 %>%
  filter( s6p4_factor == "Si" | s6p4_factor == "No" ) %>% 
  group_by(provincia_UT2020) %>%
  summarize( 
    media_ponderada_horas_deporte = weighted.mean(horas_semanales_deporte, fexp_UT2020), 
    sd_ponderada = weighted.sd(horas_semanales_deporte, fexp_UT2020),
    promedio_horas_deporte = mean(horas_semanales_deporte), 
    sd = sd(horas_semanales_deporte), 
    suma = sum(horas_semanales_deporte), 
    max = max(horas_semanales_deporte), 
    min = min(horas_semanales_deporte))

df_t_deporte_UT2020_plot4
```


```{r}
df_t_deporte_UT2020_plot5 <-  df_analisis_UT2020 %>%
  filter( s6p4_factor == "Si" | s6p4_factor == "No" ) %>% 
  group_by(provincia_UT2020, s1p2_factor) %>%
  summarize( 
    media_ponderada_horas_deporte = weighted.mean(horas_semanales_deporte, fexp_UT2020), 
    sd_ponderada = weighted.sd(horas_semanales_deporte, fexp_UT2020),
    promedio_horas_deporte = mean(horas_semanales_deporte), 
    sd = sd(horas_semanales_deporte), 
    suma = sum(horas_semanales_deporte), 
    max = max(horas_semanales_deporte), 
    min = min(horas_semanales_deporte))

df_t_deporte_UT2020_plot5
```





## Resultados


```{r, fig.height=6 , fig.width=12}
###############################################################
####                Gráficos 2012 vs 2019                  ####
###############################################################

grid.arrange(

ggplot( df_t_deporte_UT2012_plot1 , aes(x = P02_factor , y = media_ponderada_horas_deporte, fill = P02_factor )) + 
  geom_bar(stat = 'identity', position = 'dodge') + 
  scale_fill_manual(values =c("#647A8F","#FFAC8E")) +
  ylim(0,1.5) +
  labs(title = "2012", caption = " ", fill = "Sexo") +
  geom_text(aes(label = round(media_ponderada_horas_deporte, digits = 2)  ), color ="black", size = 4,position = position_dodge(0.9),vjust = -0.2) +
  xlab("Sexo") +
  ylab("Promedio de horas") +
  theme_classic()
,
ggplot( df_t_deporte_UT2020_plot1 , aes(x = s1p2_factor , y = media_ponderada_horas_deporte, fill = s1p2_factor )) + 
  geom_bar(stat = 'identity', position = 'dodge') + 
  scale_fill_manual(values =c("#647A8F","#FFAC8E")) +
  ylim(0,1.5) +
  labs(title = "2020", caption = " ", fill = "Sexo") +
  geom_text(aes(label = round(media_ponderada_horas_deporte, digits = 2)  ), color ="black", size = 4,position = position_dodge(0.9),vjust = -0.2) +
  xlab("Sexo") +
  ylab("Promedio de horas") +
  theme_classic()
,
ncol=2
,
top = textGrob("Promedio del tiempo semanal en hacer ejercicio, por sexo 2012 vs 2020 (horas)", gp=gpar(fontsize=14,font=1)))
```


```{r, fig.height=6 , fig.width=12}

grid.arrange(

ggplot( df_t_deporte_UT2012_plot2 %>% filter(rango_edad_10_UT2012 != 'No informa') , aes(x = media_ponderada_horas_deporte , y = rango_edad_10_UT2012 )) + 
  geom_bar(stat = 'identity', position = 'dodge', fill = "lightblue") + 
  xlim(0,1.5) +
  labs(title = "2012", caption = "") +
  geom_text(aes(label = round(media_ponderada_horas_deporte, digits = 2)  ), color ="#1A374D", size = 4,position = position_dodge(0.9),hjust = 1.2) +
  xlab("Promedio de horas") +
  ylab("Grupo de edad") +
  theme_classic()
,
ggplot( df_t_deporte_UT2020_plot2 , aes(x = media_ponderada_horas_deporte , y = rango_edad_10_UT2020 )) + 
  geom_bar(stat = 'identity', position = 'dodge', fill = "lightblue") + 
  xlim(0,1.5) +
  labs(title = "2020", caption = "") +
  geom_text(aes(label = round(media_ponderada_horas_deporte, digits = 2)  ), color ="#1A374D", size = 4,position = position_dodge(0.9),hjust = 1.2) +
  xlab("Promedio de horas") +
  ylab("Grupo de edad") +
  theme_classic()

,
ncol=2
,
top = textGrob("Promedio del tiempo semanal en hacer ejercicio, por grupo de edad 2012 vs 2020 (horas)", gp=gpar(fontsize=14,font=1)))
```


```{r, fig.height=6 , fig.width=12}

grid.arrange(

ggplot( df_t_deporte_UT2012_plot3 %>% filter(rango_edad_10_UT2012 != 'No informa') , aes(x = media_ponderada_horas_deporte , y = rango_edad_10_UT2012 , fill = P02_factor )) + 
  geom_bar(stat = 'identity', position = 'dodge') + 
  scale_fill_manual(values =c("#647A8F","#FFAC8E")) +
  xlim(0,2) +
  labs(title = "2012", caption = "", fill = "Sexo") +
  geom_text(aes(label = round(media_ponderada_horas_deporte, digits = 2)  ), color ="black", size = 4,position = position_dodge(0.9), hjust = 0) +
  xlab("Promedio de horas") +
  ylab("Grupo de edad") +
  theme_classic()
,
ggplot( df_t_deporte_UT2020_plot3 , aes(x = media_ponderada_horas_deporte , y = rango_edad_10_UT2020 , fill = s1p2_factor )) + 
  geom_bar(stat = 'identity', position = 'dodge') + 
  scale_fill_manual(values =c("#647A8F","#FFAC8E")) +
  xlim(0,2) +
  labs(title = "2020", caption = "", fill = "Sexo") +
  geom_text(aes(label = round(media_ponderada_horas_deporte, digits = 2)  ), color ="black", size = 4,position = position_dodge(0.9), hjust = 0) +
  xlab("Promedio de horas") +
  ylab("Grupo de edad") +
  theme_classic()

,
ncol=2
,
top = textGrob("Promedio del tiempo semanal en hacer ejercicio, por grupo de edad, por sexo 2012 vs 2020 (horas)", gp=gpar(fontsize=14,font=1)))

```


```{r, fig.height=6 , fig.width=12}
grid.arrange(

ggplot(df_t_deporte_UT2012_plot3 %>% filter(rango_edad_10_UT2012 != 'No informa'), aes(x = media_ponderada_horas_deporte , y = rango_edad_10_UT2012 , fill = P02_factor )) + 
  geom_bar(stat = 'identity', position = "fill") + 
  scale_fill_manual(values =c("#647A8F","#FFAC8E")) +
  labs(title = "2012", caption = "", fill = "Sexo") +
  xlab("Proporción") +
  ylab("Grupo de edad") +
  theme_classic()
,
ggplot( df_t_deporte_UT2020_plot3 , aes(x = media_ponderada_horas_deporte , y = rango_edad_10_UT2020 , fill = s1p2_factor )) + 
  geom_bar(stat = 'identity', position = "fill") + 
  scale_fill_manual(values =c("#647A8F","#FFAC8E")) +
  #scale_fill_manual(values =c("#5B7DB1","#FFAC8E")) +
  labs(title = "2020", caption = "", fill = "Sexo") +
  xlab("Proporción") +
  ylab("Grupo de edad") +
  theme_classic()

,
ncol=2
,
top = textGrob("Proporción del tiempo promedio semanal en hacer ejercicio, por grupo de edad, por sexo 2012 vs 2020 (horas)", gp=gpar(fontsize=14,font=1)))
```



```{r, fig.height=6 , fig.width=12}
grid.arrange(

ggplot( df_t_deporte_UT2012_plot4 , aes(x = media_ponderada_horas_deporte , y = reorder(provincia_UT2012, media_ponderada_horas_deporte) )) + 
  geom_bar(stat = 'identity', position = 'dodge', fill = "lightblue") + 
  xlim(0,3) +
  labs(title = "2012", caption = "") +
  geom_text(aes(label = round(media_ponderada_horas_deporte, digits = 2)  ), color ="#1A374D", size = 4,position = position_dodge(0.9), hjust = 1.2) +
  xlab("Promedio de horas") +
  ylab("Provincia") +
  theme_classic()
,

ggplot( df_t_deporte_UT2020_plot4 %>% 
       mutate(provincia_UT2020 = fct_relevel(provincia_UT2020, 
                                                'Azuay',
                                                'Bolívar',
                                                'Cañar',
                                                'Carchi',
                                                'Chimborazo',
                                                'Cotopaxi',
                                                'El Oro',
                                                'Esmeraldas',
                                                'Guayas',
                                                'Imbabura',
                                                'Loja',
                                                'Los Ríos',
                                                'Manabí',
                                                'Morona Santiago',
                                                'Napo',
                                                'Orellana',
                                                'Pastaza',
                                                'Pichincha',
                                                'Santa Elena',
                                                'Santo Domingo de los Tsáchilas',
                                                'Sucumbíos',
                                                'Tungurahua',
                                                'Zamora Chinchipe',
                                                'Zonas no delimitadas',
                                                'Galápagos')) %>% 
       filter(provincia_UT2020 != 'Galápagos' & provincia_UT2020 != 'Zonas no delimitadas') , aes(x = media_ponderada_horas_deporte , y = reorder(provincia_UT2020, media_ponderada_horas_deporte) )) + 
  geom_bar(stat = 'identity', position = 'dodge', fill = "lightblue") + 
  xlim(0,3) +
  labs(title = "2020", caption = "") +
  geom_text(aes(label = round(media_ponderada_horas_deporte, digits = 2)  ), color ="#1A374D", size = 4,position = position_dodge(0.9), hjust = 1.2) +
  xlab("Promedio de horas") +
  ylab("Provincia") +
  theme_classic()

,
ncol=2
,
top = textGrob("Promedio del tiempo semanal en hacer ejercicio, por provincia 2012 vs 2020 (horas)", gp=gpar(fontsize=14,font=1)))
```



```{r echo=FALSE, fig.height=6 , fig.width=12}
grid.arrange(

ggplot( df_t_deporte_UT2012_plot4 %>% filter(provincia_UT2012 != 'Zonas no delimitadas') , aes(x = media_ponderada_horas_deporte , y = provincia_UT2012 )) + 
  geom_bar(stat = 'identity', position = 'dodge', fill = "lightblue") + 
  xlim(0,3) +
  labs(title = "2012", caption = "") +
  geom_text(aes(label = round(media_ponderada_horas_deporte, digits = 2)  ), color ="#1A374D", size = 4,position = position_dodge(0.9), hjust = 1.2) +
  xlab("Promedio de horas") +
  ylab("Provincia") +
  theme_classic()
,

ggplot( df_t_deporte_UT2020_plot4 %>% 
       mutate(provincia_UT2020 = fct_relevel(provincia_UT2020, 
                                                'Azuay',
                                                'Bolívar',
                                                'Cañar',
                                                'Carchi',
                                                'Chimborazo',
                                                'Cotopaxi',
                                                'El Oro',
                                                'Esmeraldas',
                                                'Guayas',
                                                'Imbabura',
                                                'Loja',
                                                'Los Ríos',
                                                'Manabí',
                                                'Morona Santiago',
                                                'Napo',
                                                'Orellana',
                                                'Pastaza',
                                                'Pichincha',
                                                'Santa Elena',
                                                'Santo Domingo de los Tsáchilas',
                                                'Sucumbíos',
                                                'Tungurahua',
                                                'Zamora Chinchipe',
                                                'Zonas no delimitadas',
                                                'Galápagos')) %>% 
       filter(provincia_UT2020 != 'Galápagos' & provincia_UT2020 != 'Zonas no delimitadas') , aes(x = media_ponderada_horas_deporte , y = provincia_UT2020 )) + 
  geom_bar(stat = 'identity', position = 'dodge', fill = "lightblue") + 
  xlim(0,3) +
  labs(title = "2020", caption = "") +
  geom_text(aes(label = round(media_ponderada_horas_deporte, digits = 2)  ), color ="#1A374D", size = 4,position = position_dodge(0.9), hjust = 1.2) +
  xlab("Promedio de horas") +
  ylab("Provincia") +
  theme_classic()

,
ncol=2
,
top = textGrob("Promedio del tiempo semanal en hacer ejercicio, por provincia 2012 vs 2020 (horas)", gp=gpar(fontsize=14,font=1)))

```


```{r, fig.height=6 , fig.width=12}
grid.arrange(

ggplot( df_t_deporte_UT2012_plot5 %>% filter(provincia_UT2012 == 'Pichincha' | provincia_UT2012 == 'Guayas' | provincia_UT2012 == 'Azuay') , aes(x = provincia_UT2012 , y = media_ponderada_horas_deporte  , fill = P02_factor )) + 
  geom_bar(stat = 'identity', position = 'dodge') + 
  scale_fill_manual(values =c("#647A8F","#FFAC8E")) +
  ylim(0,2) +
  labs(title = "2012", caption = "", fill = "Sexo") +
  geom_text(aes(label = round(media_ponderada_horas_deporte, digits = 2)  ), color ="black", size = 4,position = position_dodge(0.9), vjust = -0.2) +
  xlab("Promedio de horas") +
  ylab("Provincia") +
  theme_classic()
,
ggplot( df_t_deporte_UT2020_plot5 %>% filter(provincia_UT2020 == 'Pichincha' | provincia_UT2020 == 'Guayas' | provincia_UT2020 == 'Azuay') , aes(x = provincia_UT2020  , y = media_ponderada_horas_deporte , fill = s1p2_factor )) + 
  geom_bar(stat = 'identity', position = 'dodge') + 
  scale_fill_manual(values =c("#647A8F","#FFAC8E")) +
  ylim(0,2) +
  labs(title = "2020", caption = "", fill = "Sexo") +
  geom_text(aes(label = round(media_ponderada_horas_deporte, digits = 2)  ), color ="black", size = 4,position = position_dodge(0.9), vjust = -0.2) +
  xlab("Promedio de horas") +
  ylab("Provincia") +
  theme_classic()

,
ncol=2
,
top = textGrob("Promedio del tiempo semanal en hacer ejercicio, por provincia, por sexo 2012 vs 2020 (horas)", gp=gpar(fontsize=14,font=1)))
```


```{r, fig.height=6 , fig.width=12}
grid.arrange(

ggplot( df_t_deporte_UT2012_plot5 %>% filter(provincia_UT2012 != 'Zonas no delimitadas') , aes(x = media_ponderada_horas_deporte , y = provincia_UT2012 , fill =  P02_factor  )) + 
  geom_bar(stat = 'identity', position = 'fill') +
  scale_fill_manual(values =c("#647A8F","#FFAC8E")) +
  labs(title = "2012", caption = "", fill = "Sexo") +
  xlab("Proporción") +
  ylab("Provincia") +
  theme_classic()
,
ggplot(df_t_deporte_UT2020_plot5 %>% 
       mutate(provincia_UT2020 = fct_relevel(provincia_UT2020, 
                                                'Azuay',
                                                'Bolívar',
                                                'Cañar',
                                                'Carchi',
                                                'Chimborazo',
                                                'Cotopaxi',
                                                'El Oro',
                                                'Esmeraldas',
                                                'Guayas',
                                                'Imbabura',
                                                'Loja',
                                                'Los Ríos',
                                                'Manabí',
                                                'Morona Santiago',
                                                'Napo',
                                                'Orellana',
                                                'Pastaza',
                                                'Pichincha',
                                                'Santa Elena',
                                                'Santo Domingo de los Tsáchilas',
                                                'Sucumbíos',
                                                'Tungurahua',
                                                'Zamora Chinchipe',
                                                'Zonas no delimitadas',
                                                'Galápagos')) %>% 
       filter(provincia_UT2020 != 'Galápagos' & provincia_UT2020 != 'Zonas no delimitadas')  , aes(x = media_ponderada_horas_deporte , y = provincia_UT2020 , fill = s1p2_factor )) + 
  geom_bar(stat = 'identity', position = 'fill') + 
  scale_fill_manual(values =c("#647A8F","#FFAC8E")) +
  labs(title = "2020", caption = "", fill = "Sexo") +
  xlab("Proporción") +
  ylab("Provincia") +
  theme_classic()

,
ncol=2
,
top = textGrob("Proporción del tiempo promedio semanal dedicado en hacer ejercicio, por sexo, por provincia 2012 vs 2020", gp=gpar(fontsize=14,font=1)))
```




# Comparacion



Referencias

Instituto Nacional de Estadística y Censos INEC. (2013). "Metodología de la Encuesta Específica de Uso del Tiempo - 2012." Ecuador, Noviembre 2013. Recuperado de: https://www.ecuadorencifras.gob.ec//documentos/web-inec/Uso_Tiempo/Metodologia_EUT_2012.pdf

Instituto Nacional de Estadística y Censos INEC. (2012). "Encuesta específica de uso del tiempo EUT 2012" Ecuador, Noviembre 2012. Recuperado de: https://www.ecuadorencifras.gob.ec//documentos/web-inec/Uso_Tiempo/Formulario_2012.pdf

Instituto Nacional de Estadística y Censos INEC. (2012). "Encuesta específica de uso del tiempo EUT 2012" [base de datos]. Ecuador. Recuperado de: https://www.ecuadorencifras.gob.ec/uso-del-tiempo-2/#:~:text=Uso%20del%20Tiempo%20%E2%80%93%202012,y%20formulaci%C3%B3n%20de%20pol%C3%ADticas%20p%C3%BAblicas.

Instituto Nacional de Estadística y Censos INEC. (2020). "Documento metodológico de la Encuesta Nacional Multipropósito de Hogares (Seguimiento al Plan Nacional de Desarrollo)-2019" Ecuador, 2020. Recuperado de: https://www.ecuadorencifras.gob.ec/documentos/web-inec/Multiproposito/2019/201912_Metodologia_Multiproposito.pdf 

Instituto Nacional de Estadística y Censos INEC. (2019). "Encuesta Nacional Multipropósito de Hogares-Diciembre-2019" Recuperado de: https://www.ecuadorencifras.gob.ec/documentos/web-inec/Multiproposito/2019/201912_Formulario_Multiproposito.pdf


Instituto Nacional de Estadística y Censos INEC. (2020). "Guia para el usuario de base de datos. Encuesta Nacional Multipropósito de Hogares (Seguimiento al Plan Nacional de Desarrollo)" Ecuador, junio 2020. Recuperado de: https://www.ecuadorencifras.gob.ec/documentos/web-inec/Multiproposito/2019/201912_%20Guia%20de%20usuario%20BDD_Multiproposito.pdf 

Instituto Nacional de Estadística y Censos INEC. (2019). "Encuesta Nacional Multipropósito de Hogares (Seguimiento al Plan Nacional de Desarrollo)-2019" [base de datos]







