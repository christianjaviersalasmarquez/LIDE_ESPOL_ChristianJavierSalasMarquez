---
title: "Tiempo de actividad física de los ecuatorianos"
author: "Christian Javier Salas Marquez"
date: "Marzo de 2022"
output: html_notebook
---

Work in progress

Last edited: 22-03-2022

En este script se busca comparar los resultados de la pregunta: En la semana pasada... ¿Hizo ejercicios o practicó algún deporte?
Tanto en la encuesta de uso del tiempo del 2012 como en la encuesta nacional multipropósito del 2020 se encuentra esta pregunta.


```{r}
###############################################################
####                   Librerias                           ####
###############################################################

if(!require(tidyverse)) install.packages("tidyverse", repos = "http://cran.us.r-project.org")
if(!require(haven)) install.packages("haven", repos = "http://cran.us.r-project.org")
if(!require(readr)) install.packages("readr", repos = "http://cran.us.r-project.org")

```

```{r}
###############################################################
####                   Descargar los datos                 ####
###############################################################

# Base de datos 
# Le damos un nombre al url
url <- "https://github.com/christianjaviersalasmarquez/LIDE_ESPOL_Christian_Salas/raw/main/Base%20EUT%202012.zip"
# Creamos un directorio temporal
td <- tempdir()
# Creamos una carpeta temporal
tf <- tempfile(tmpdir=td, fileext = ".zip")
# Descargamos los discap en la carpeta temporal
download.file(url,tf)

```

```{r}
# Obtenemos el nombre del archivo dentro del archivo zip, lo descomprimimos (unzip), obtenemos el nombre del 
# parche, y finalmente lo cargamos
EUT2012.f.name <- unzip(tf, list=TRUE)$Name[1] # El archivo SAV de la EUT 2012 es el primero
unzip(tf, files=EUT2012.f.name, exdir=td, overwrite=TRUE)
EUT2012.f.path <- file.path(td, EUT2012.f.name)
uso_del_tiempo_2012 <- read_sav(EUT2012.f.path)
```

```{r}
data_UT2012 <- data.frame(uso_del_tiempo_2012)
```

```{r}
educacion_actfisica_tics_2020 <- read.csv2("https://raw.githubusercontent.com/christianjaviersalasmarquez/LIDE_ESPOL_Christian_Salas/main/202012_multibdd_educaci%C3%B3n_actfisica_tics.csv", header = FALSE)
```

```{r}
personas_2020 <- read.csv2("https://raw.githubusercontent.com/christianjaviersalasmarquez/LIDE_ESPOL_Christian_Salas/main/202012_multibdd_personas.csv", header = FALSE)
```




```{r}
header_true <- function(df) {
  names(df) <- as.character(unlist(df[1,]))
  df[-1,]
}
```

```{r}
data_EDUCACION_ACTFISICA_TICS2020 <- header_true(educacion_actfisica_tics_2020)

colnames(data_EDUCACION_ACTFISICA_TICS2020)[1] <- 'area'
```

```{r}
data_personas2020 <- header_true(personas_2020)

colnames(data_personas2020)[1] <- 'area'
```

```{r}
df_info_personas2020 <- data.frame(id_per = data_personas2020$id_per, s1p2 = data_personas2020$s1p2)

df_analisis_UT2020 <- merge(df_info_personas2020, data_EDUCACION_ACTFISICA_TICS2020, by = "id_per")
```



# 2012



# 2020

CONTEOS

```{r}
df_analisis_UT2020$s1p2_factor <- fct_recode(factor(df_analisis_UT2020$s1p2), "Hombre"="1","Mujer"="2" )
df_analisis_UT2020$s6p4_factor <- fct_recode(factor(df_analisis_UT2020$s6p4), "Si"="1","No"="2" ) 
```








```{r}
# En la semana pasada ¿Hizo ejercicios o practicó algún deporte? Por sexo
df_deporte_sexo2020 <- df_analisis_UT2020 %>%
  group_by(s1p2_factor, s6p4_factor) %>%
  summarize(conteo_deporte = summary(factor(s6p4)))

df_deporte_sexo2020
```

```{r}
ggplot(df_deporte_sexo2020 %>% filter(s6p4_factor == "Si" | s6p4_factor == "No"), aes(x = s1p2_factor, y = conteo_deporte, fill = s6p4_factor )) + 
  geom_bar(stat = 'identity', position = 'dodge') + 
  labs(title = "¿Hizo ejercicio o practicó algún deporte? Respuestas por sexo en 2020", caption = "Fuente: INEC") + 
  geom_text(aes(label = conteo_deporte), color ="black", size = 3,position = position_dodge(0.9),vjust = 0) +
  theme_classic()
```




```{r}
# Rango de edades 

edad_2020 <- as.numeric(df_analisis_UT2020$s1p3)

R = length(edad_2020)
rango_edad_10 <- rep(0,R)

for (i in 1:R) {
  
  if((edad_2020[i] >= 0 ) & (edad_2020[i] <= 11)) { rango_edad_10[i] <- 'Edad entre 0 y 11 años' }
  else if ( (edad_2020[i] >=12  ) & (edad_2020[i] <= 19  ) ) { rango_edad_10[i] <- 'Edad entre 12 y 19 años' }
  else if ( (edad_2020[i] >=20  ) & (edad_2020[i] <= 29  ) ) { rango_edad_10[i] <- 'Edad entre 20 y 29 años' }
  else if ( (edad_2020[i] >=30  ) & (edad_2020[i] <= 39  ) ) { rango_edad_10[i] <- 'Edad entre 30 y 39 años' }
  else if ( (edad_2020[i] >=40  ) & (edad_2020[i] <= 49  ) ) { rango_edad_10[i] <- 'Edad entre 40 y 49 años' }
  else if ( (edad_2020[i] >=50  ) & (edad_2020[i] <= 59  ) ) { rango_edad_10[i] <- 'Edad entre 50 y 59 años' }
  else if ( (edad_2020[i] >=60  ) & (edad_2020[i] <= 69  ) ) { rango_edad_10[i] <- 'Edad entre 60 y 69 años' }
  else if ( (edad_2020[i] >=70  )) { rango_edad_10[i] <- 'Edad mayor a 70 años' }
  
  
}

df_analisis_UT2020$rango_edad_10 <- factor(rango_edad_10)
```


```{r}
# En la semana pasada ¿Hizo ejercicios o practicó algún deporte? Por rango de edad de cada 10 años
df_deporte_edad2020 <- df_analisis_UT2020 %>%
  group_by(rango_edad_10, s6p4_factor) %>%
  summarize(conteo_deporte = summary(factor(s6p4)))

df_deporte_edad2020
```


```{r}
ggplot(df_deporte_edad2020 %>% filter(s6p4_factor == "Si" | s6p4_factor == "No"), aes(x = conteo_deporte  , y = rango_edad_10 , fill = s6p4_factor )) + 
  geom_bar(stat = 'identity', position = 'dodge') + 
  labs(title = "¿Hizo ejercicio o practicó algún deporte? Respuestas por grupo de edad en 2020", caption = "Fuente: INEC") + 
  geom_text(aes(label = conteo_deporte), color ="black", size = 3,position = position_dodge(0.9),vjust = 0) +
  theme_classic()
```



TIEMPO


Se debe considerar también el tiempo de respuesta de los que responden que NO hicieron actividad física o deporte en la semana pasada, lo que implica que el encuestado realizó 0 horas de deporte, lo cual también influye en el promedio y debe considerarse.


```{r}
df_analisis_UT2020_s6p4 <- data.frame( s6p4a = as.numeric(df_analisis_UT2020$s6p4a),s6p4b =  as.numeric(df_analisis_UT2020$s6p4b), s6p4c = as.numeric(df_analisis_UT2020$s6p4c), s6p4d = as.numeric(df_analisis_UT2020$s6p4d))

df_analisis_UT2020_s6p4[is.na(df_analisis_UT2020_s6p4)] <- 0


df_analisis_UT2020$horas_semanales_deporte <- df_analisis_UT2020_s6p4$s6p4a + (df_analisis_UT2020_s6p4$s6p4b/60) + df_analisis_UT2020_s6p4$s6p4c + (df_analisis_UT2020_s6p4$s6p4d/60)
```



Cuanto tiempo...? Promedio de horas semanales deporte, por sexo. Considerando tanto a los que respondieron que si como los que respondieron que no.

```{r}
df_analisis_UT2020_sexo_summary <-  df_analisis_UT2020 %>%
  filter( s6p4_factor == "Si" | s6p4_factor == "No" ) %>%
  group_by(s1p2_factor) %>%
  summarize( promedio_horas_deporte = mean(horas_semanales_deporte), sd = sd(horas_semanales_deporte), suma = sum(horas_semanales_deporte), max = max(horas_semanales_deporte), min = min(horas_semanales_deporte)  )

df_analisis_UT2020_sexo_summary
```


```{r}
ggplot(df_analisis_UT2020_sexo_summary, aes(x = promedio_horas_deporte , y = s1p2_factor)) + 
  labs(title = "Promedio de horas semanales de actividad física por sexo en 2020") +
  geom_segment(aes(xend =0, yend = s1p2_factor), size = 4, color = "lightblue") +
  geom_point(size = 8, color = "blue") +
  geom_text(aes(label = round(promedio_horas_deporte, digits = 1.5)), color ="white", size = 3) +
  theme_classic() +
  theme(axis.line.y = element_blank(),
        axis.ticks.y = element_blank(),
        axis.text = element_text(color = "black"),
        axis.title = element_blank(),
        legend.position = "none")
```


```{r}
ggplot(df_analisis_UT2020_sexo_summary, aes(x = promedio_horas_deporte , y = s1p2_factor)) + 
  labs(title = "Promedio de horas semanales de actividad física por sexo en 2020") +
  geom_segment(aes(xend =0, yend = s1p2_factor), size = 4, color = "lightblue") +
  geom_point(size = 8, color = "white") +
  geom_text(aes(label = round(promedio_horas_deporte, digits = 1.5)), color ="black", size = 3) +
  theme_classic() +
  theme(axis.line.y = element_blank(),
        axis.ticks.y = element_blank(),
        axis.text = element_text(color = "black"),
        axis.title = element_blank(),
        legend.position = "none")
```


```{r}
ggplot(df_analisis_UT2020_sexo_summary, aes(x = promedio_horas_deporte , y = s1p2_factor)) + geom_bar(stat = 'identity')
```





De los que respondieron Si y No. cuanto tiempo...? Promedio de horas semanales deporte, por edad. Considerar por grupos de edad de cada 10 años.

```{r}
df_analisis_UT2020_edad_summary <- df_analisis_UT2020 %>%
  filter( s6p4_factor == "Si" | s6p4_factor == "No" ) %>%
  group_by(rango_edad_10) %>%
  summarize( promedio_horas_deporte = mean(horas_semanales_deporte), sd = sd(horas_semanales_deporte), suma = sum(horas_semanales_deporte), max = max(horas_semanales_deporte), min = min(horas_semanales_deporte) )

df_analisis_UT2020_edad_summary
```




```{r}
ggplot(df_analisis_UT2020_edad_summary, aes(x = promedio_horas_deporte, y = rango_edad_10)) + 
  labs(title = "Promedio de horas semanales de actividad física por edad en 2020") +
  geom_segment(aes(xend =0, yend = rango_edad_10), size = 2, color = "lightblue") +
  geom_point(size = 8, color = "blue") + 
  geom_text(aes(label = round(promedio_horas_deporte, digits = 1.5)), color ="white", size = 3) +
  theme_classic() +
  theme(axis.line.y = element_blank(),
        axis.ticks.y = element_blank(),
        axis.text = element_text(color = "black"),
        axis.title = element_blank(),
        legend.position = "none")
```




```{r}
# CONSIDERAR UN ANALISIS A LAS PRINCIPALES CIUDADES 
df_analisis_UT2020 %>%
  filter( s6p4_factor == "Si" | s6p4_factor == "No" ) %>%
  group_by(factor(ciudad)) %>%
  summarize( promedio_horas_deporte = mean(horas_semanales_deporte), sd = sd(horas_semanales_deporte), suma = sum(horas_semanales_deporte)  )
```



Segmentar por provincia. Esperar el significado de los códigos de ciudad (verificar si los 3 primeros dígitos indican la provincia)

Segmentar por región.





# Comparacion



Referencias

Instituto Nacional de Estadística y Censos INEC. (2013). "Metodología de la Encuesta Específica de Uso del Tiempo - 2012." Ecuador, Noviembre 2013. Recuperado de: https://www.ecuadorencifras.gob.ec//documentos/web-inec/Uso_Tiempo/Metodologia_EUT_2012.pdf

Instituto Nacional de Estadística y Censos INEC. (2012). "Encuesta específica de uso del tiempo EUT 2012" Ecuador, Noviembre 2012. Recuperado de: https://www.ecuadorencifras.gob.ec//documentos/web-inec/Uso_Tiempo/Formulario_2012.pdf

Instituto Nacional de Estadística y Censos INEC. (2012). "Encuesta específica de uso del tiempo EUT 2012" [base de datos]. Ecuador. Recuperado de: https://www.ecuadorencifras.gob.ec/uso-del-tiempo-2/#:~:text=Uso%20del%20Tiempo%20%E2%80%93%202012,y%20formulaci%C3%B3n%20de%20pol%C3%ADticas%20p%C3%BAblicas.

Instituto Nacional de Estadística y Censos INEC. (2020). "Documento metodológico de la Encuesta Nacional Multipropósito de Hogares (Seguimiento al Plan Nacional de Desarrollo)-2019" Ecuador, 2020. Recuperado de: https://www.ecuadorencifras.gob.ec/documentos/web-inec/Multiproposito/2019/201912_Metodologia_Multiproposito.pdf 

Instituto Nacional de Estadística y Censos INEC. (2019). "Encuesta Nacional Multipropósito de Hogares-Diciembre-2019" Recuperado de: https://www.ecuadorencifras.gob.ec/documentos/web-inec/Multiproposito/2019/201912_Formulario_Multiproposito.pdf


Instituto Nacional de Estadística y Censos INEC. (2020). "Guia para el usuario de base de datos. Encuesta Nacional Multipropósito de Hogares (Seguimiento al Plan Nacional de Desarrollo)" Ecuador, junio 2020. Recuperado de: https://www.ecuadorencifras.gob.ec/documentos/web-inec/Multiproposito/2019/201912_%20Guia%20de%20usuario%20BDD_Multiproposito.pdf 

Instituto Nacional de Estadística y Censos INEC. (2019). "Encuesta Nacional Multipropósito de Hogares (Seguimiento al Plan Nacional de Desarrollo)-2019" [base de datos]







