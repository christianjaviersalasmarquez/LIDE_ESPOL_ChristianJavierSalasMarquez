---
title: "Uso del tiempo de los ecuatorianos"
author: "Christian Javier Salas Marquez"
date: "2022-03-17"
output: html_notebook
---

```{r}
###############################################################
####                   Librerias                           ####
###############################################################

if(!require(tidyverse)) install.packages("tidyverse", repos = "http://cran.us.r-project.org")
if(!require(haven)) install.packages("haven", repos = "http://cran.us.r-project.org")
if(!require(readr)) install.packages("readr", repos = "http://cran.us.r-project.org")


```


```{r}
###############################################################
####                   Descargar los datos                 ####
###############################################################


# Base de datos 
# Le damos un nombre al url
url <- "https://github.com/christianjaviersalasmarquez/LIDE_ESPOL_Christian_Salas/raw/main/Base%20EUT%202012.zip"
# Creamos un directorio temporal
td <- tempdir()
# Creamos una carpeta temporal
tf <- tempfile(tmpdir=td, fileext = ".zip")
# Descargamos los discap en la carpeta temporal
download.file(url,tf)

```


```{r}
# Obtenemos el nombre del archivo dentro del archivo zip, lo descomprimimos (unzip), obtenemos el nombre del 
# parche, y finalmente lo cargamos
EUT2012.f.name <- unzip(tf, list=TRUE)$Name[1] # El archivo SAV de la EUT 2012 es el primero
unzip(tf, files=EUT2012.f.name, exdir=td, overwrite=TRUE)
EUT2012.f.path <- file.path(td, EUT2012.f.name)
uso_del_tiempo_2012 <- read_sav(EUT2012.f.path)
```


```{r}
#data_UT2012 <- uso_del_tiempo_2012
data_UT2012 <- data.frame(uso_del_tiempo_2012)
```


```{r}
uso_del_tiempo_2019 <- read.csv2("https://raw.githubusercontent.com/christianjaviersalasmarquez/LIDE_ESPOL_Christian_Salas/main/201912_multibdd_uso_del_tiempo.sav.csv", header = FALSE)
```


```{r}
personas_2019 <- read.csv2("https://raw.githubusercontent.com/christianjaviersalasmarquez/LIDE_ESPOL_Christian_Salas/main/201912_multibdd_personas.sav.csv", header = FALSE)
```








```{r}
header_true <- function(df) {
  names(df) <- as.character(unlist(df[1,]))
  df[-1,]
}

```

```{r}
data_UT2019 <- header_true(uso_del_tiempo_2019)

colnames(data_UT2019)[1] <- 'area'
```

```{r}
data_personas2019 <- header_true(personas_2019)

colnames(data_personas2019)[1] <- 'area'
```



En el año 2012, se ejecutó la Encuesta Específica de Uso del Tiempo, la cual tiene un tamaño muestral de 22968 viviendas, cuya población objetivo son las personas de 12 años y más. El periodo de levantamiento fue entre noviembre y diciembre de 2012.

De acuerdo con el INEC, las encuestas de uso del tiempo son importantes porque proporcionan una forma de conocer la distribución de tiempos entre hombres y mujeres. 

En el año 2019, el uso del tiempo es un módulo de la Encuesta Nacional Multipropósito de Hogares. Entre las diferencias metodológicas, en la Encuesta Nacional Multipropósito de Hogares la población objetivo abarca los hogares y personas constituidas por personas de 5 años y más. El tamaño muestral fue de 12072 viviendas. 

# 2012

```{r}
# Histograma de las edades

hist(data_UT2012$P03)

```


```{r}
# OPTIMIZAR
#t_trabajo_mercado_laboral <- data_UT2012 %>%
#  rowwise() %>%
#  mutate(tiempo_trabajo_mercadolaboral = sum(as.numeric(P19A), (as.numeric(P19B)/60),as.numeric(P19C), (as.numeric(P19D)/60), na.rm = #TRUE))

```


```{r}
# OPTIMIZAR
#tiempo_trabajo <- t_trabajo_mercado_laboral$tiempo_trabajo_mercadolaboral

#ggplot(t_trabajo_mercado_laboral, aes(x =tiempo_trabajo_mercadolaboral )) + geom_histogram()

```





# 2019

```{r}
# Histograma de las edades 2019
hist(as.numeric(df_analisis_UT2019$s1p3))
```


```{r}
#Merge de la base de datos de uso del tiempo con la de personas, para conocer información sobre la persona

df_info_personas2019 <- data.frame(id_per = data_personas2019$id_per, s1p2 = data_personas2019$s1p2, s1p3 = data_personas2019$s1p3)

df_analisis_UT2019 <- merge(df_info_personas2019, data_UT2019, by = "id_per")


```

```{r}
df_analisis_UT2019$s1p2_factor <- fct_recode(factor(df_analisis_UT2019$s1p2), "Hombre"="1","Mujer"="2" )
df_analisis_UT2019$s51p2_factor <- fct_recode(factor(df_analisis_UT2019$s51p2), "Si"="1","No"="2" ) 
```



De los encuestados, ¿Cuántos respondieron que sí participan en los quehaceres del hogar y cuantos no?


```{r}
s51p1_2019 <- data_UT2019$s51p1
s51p1_2019_factor <- factor(data_UT2019$s51p1)
levels(s51p1_2019_factor) <- c("Si","No")
summary(s51p1_2019_factor)
```



```{r include = FALSE}
#s51p1_2019 <- df_analisis_UT2019$s51p1
#s51p1_2019_factor <- factor(df_analisis_UT2019$s51p1)
#levels(s51p1_2019_factor) <- c("Si","No")

#s1p2_2019_factor <- factor(df_analisis_UT2019$s1p2)
#levels(s1p2_2019_factor) <- c("Hombre","Mujer")

#summary(s51p1_2019_factor)
#summary(s1p2_2019_factor)



```


```{r}
# Summarize() con summary()
# Participa en quehaceres del hogar? Por sexo
df_hogar_sexo <- df_analisis_UT2019 %>%
  group_by(s1p2_factor, participacion = fct_recode(factor(s51p1), "Si" = "1", "No" = "2" )) %>%
  summarize(conteo_actividades_hogar = summary(factor(s51p1)))

df_hogar_sexo
```

```{r include = FALSE}
# Summarize() con length también funciona igual
# Participa en quehaceres del hogar? Por sexo
#df_hogar_sexo <- df_analisis_UT2019 %>%
#  group_by(s1p2_factor,fct_recode(factor(s51p1), "Si" = "1", "No" = "2" )) %>%
#  summarize(conteo_actividades_hogar = length(factor(s51p1)))

# df_hogar_sexo
```

```{r include = FALSE}
# Validacion cantidad de Si o No en s51p1: Success

#summary(fct_recode(factor(data_UT2019$s51p1), "Si" = "1", "No"="2"))[1] ==  df_hogar_sexo$conteo_actividades_hogar[1] + df_hogar_sexo$conteo_actividades_hogar[3]

#summary(fct_recode(factor(data_UT2019$s51p1), "Si" = "1", "No"="2"))[2] == df_hogar_sexo$conteo_actividades_hogar[2] + df_hogar_sexo$conteo_actividades_hogar[4]



# summary(factor(data_UT2019$s51p1))[1] + summary(factor(data_UT2019$s51p1))[2] # Cantidad de respuesta Si + No 33236

```



```{r include = FALSE}
# Validación cantidad de hombres y mujeres en s1p2: Success
# El conteo en el summarize() funciona tanto con summary() como con length()

#summary(factor(df_analisis_UT2019$s1p2))[1] == df_hogar_sexo$conteo_actividades_hogar[1] + df_hogar_sexo$conteo_actividades_hogar[2]

#summary(factor(df_analisis_UT2019$s1p2))[2] == df_hogar_sexo$conteo_actividades_hogar[3] + df_hogar_sexo$conteo_actividades_hogar[4]

# summary(factor(df_analisis_UT2019$s1p2))[1] + summary(factor(df_analisis_UT2019$s1p2))[2] # Cantidad de Hombres + Mujeres en data_UT2019 33236


```



```{r}
# ¿Participa en los quehaceres del hogar? Respuestas de Hombres y Mujeres
ggplot(df_hogar_sexo, aes(x = s1p2_factor, y = conteo_actividades_hogar, fill = participacion)) + geom_bar(stat = 'identity')
```


```{r}
ggplot(df_hogar_sexo, aes(x = s1p2_factor, y = conteo_actividades_hogar, fill = participacion)) + geom_bar(stat = 'identity', position = 'dodge')
```




# Comparacion de participacion 2012 y 2019






```{r}
# 2012
# EN LA SEMANA PASADA: ¿Cocinó o preparó alimentos para consumirse en el desayuno, almuerzo, merienda, entre comidas, incluyendo comidas para llevar?

UT15_2012 <- data_UT2012$UT15

UT15_2012 <- factor(UT15_2012)

#str(UT15_2012)
#class(UT15_2012)

summary(UT15_2012)

# dim(data_UT2012[1])[1] == summary(UT15_2012)[1] + summary(UT15_2012)[2] + summary(UT15_2012)[3]



```


```{r}
df_analisis_UT15_UT2012 <- data.frame(P02_factor = fct_recode(factor(data_UT2012$P02), "Hombre" = "1", "Mujer"="2") , CIUDAD = data_UT2012$CIUDAD, UT15 = data_UT2012$UT15 , UT15_factor = fct_recode(factor(data_UT2012$UT15), "Si"="1","No"="2" ) , UT15A = data_UT2012$UT15A, UT15B = data_UT2012$UT15B, UT15C = data_UT2012$UT15C, UT15D = data_UT2012$UT15D)
```

```{r}
# SUCCESS

df_cocina_sexo_2012 <- df_analisis_UT15_UT2012 %>%
  group_by( P02_factor , UT15_factor ) %>%
  summarize(conteo_cocina = summary( factor(UT15) ))

df_cocina_sexo_2012
# Hay 11623 hombres con NA y 10835 mujeres con NA. Sumando el total de 22458 de la pregunta UT15

```

```{r include = FALSE}
#df_analisis_UT15_UT2012 %>%
#  group_by( P02_factor , UT15_factor ) %>%
#  summarize(conteo_cocina = summary( UT15_factor ))

# Funciona pero resulta en filas adicionales innecesarias
```


```{r}
# Considerando NA values

ggplot(df_cocina_sexo_2012, aes(x = P02_factor, y = conteo_cocina, fill =  UT15_factor)) + geom_bar(stat = 'identity', position = 'dodge')

# Pensar en considerar las edades o rango de edades

```

```{r}
# Sin considerar NA values

df_cocina_sexo_2012_plot <- df_cocina_sexo_2012 %>%
  filter( UT15_factor == "Si" | UT15_factor == "No" )

ggplot(df_cocina_sexo_2012_plot, aes(x = P02_factor, y = conteo_cocina, fill =  UT15_factor)) + geom_bar(stat = 'identity', position = 'dodge')
```

```{r}
# Proporciones

#df_cocina_sexo_2012

#df_cocina_sexo_2012[1,3] + df_cocina_sexo_2012[2,3] # Total de hombres que respondieron la pregunta UT15


#df_cocina_sexo_2012[4,3] + df_cocina_sexo_2012[5,3] # Total de mujeres que respondieron la pregunta UT15


p_hombres_cocina_si_2012 <- df_cocina_sexo_2012[1,3]/(df_cocina_sexo_2012[1,3] + df_cocina_sexo_2012[2,3])

p_mujeres_cocina_si_2012 <- df_cocina_sexo_2012[4,3]/(df_cocina_sexo_2012[4,3] + df_cocina_sexo_2012[5,3] )

p_hombres_cocina_si_2012

p_mujeres_cocina_si_2012

```


En el 2012, de los hombres y mujeres que respondieron la pregunta 'En la semana pasada, ¿Cocinó o preparó alimentos...?', un 13% de los hombres respondieron que Si y un 71% de las mujeres respondieron que Si.


```{r}
# 2019
# La semana pasada... Cocinó o preparó alimentos para consumirse en el desayuno, almuerzo, merienda, entre comidas, incluyendo comidas para llevar?



df_cocina_sexo_2019 <- df_analisis_UT2019 %>%
  group_by(s1p2_factor, s51p2_factor) %>%
  summarize(conteo_cocina = summary( factor(s1p2)  ) )  #Resulta el mismo conteo si se coloca factor(s1p2) o factor(s51p2) en el summary

df_cocina_sexo_2019

```



```{r include =  FALSE}
# Validacion df_cocina_sexo_2019: Success

#summary( fct_recode( factor(df_analisis_UT2019$s1p2), "Hombre"="1","Mujer"="2" ) )[1] == df_cocina_sexo_2019[1,3] + df_cocina_sexo_2019[2,3] + df_cocina_sexo_2019[3,3]

#summary( fct_recode( factor(df_analisis_UT2019$s1p2), "Hombre"="1","Mujer"="2" ) )[2] == df_cocina_sexo_2019[4,3] + df_cocina_sexo_2019[5,3] + df_cocina_sexo_2019[6,3]


```




```{r}
# Considerando NA values
ggplot(df_cocina_sexo_2019, aes(x = s1p2_factor, y = conteo_cocina, fill = s51p2_factor)) + geom_bar(stat = 'identity', position = 'dodge')

# Pensar en considerar las edades o rango de edades

```

```{r}
# Sin considerar NA values: Visto bueno por la explicación del siguiente chunk

df_cocina_sexo_2019_plot <- df_cocina_sexo_2019 %>%
  filter(s51p2_factor == "Si" | s51p2_factor == "No")

ggplot(df_cocina_sexo_2019_plot, aes(x = s1p2_factor, y = conteo_cocina, fill = s51p2_factor)) + geom_bar(stat = 'identity', position = 'dodge') + labs(title = "Cocinó o preparo alimentos por sexo", caption = "Fuente: INEC")
```

```{r}
# Proporciones

#df_cocina_sexo_2019

#df_cocina_sexo_2019[2,3]  + df_cocina_sexo_2019[3,3] # Total hombres que si participan en el hogar

#df_cocina_sexo_2019[5,3]  + df_cocina_sexo_2019[6,3] # Total mujeres que si participan en el hogar

p_hombres_cocina_si_2019 <- df_cocina_sexo_2019[2,3]/(df_cocina_sexo_2019[2,3]  + df_cocina_sexo_2019[3,3])

p_mujeres_cocina_si_2019 <- df_cocina_sexo_2019[5,3]/(df_cocina_sexo_2019[5,3]  + df_cocina_sexo_2019[6,3])


p_hombres_cocina_si_2019
p_mujeres_cocina_si_2019


```


Podemos estudiar las proporciones. En el 2019, el 54% de los hombres respondieron que si cocinó o preparó alimentos, mientras que el 89% de las mujeres respondieron que si.


```{r}
# Explicacion de los NA

summary(fct_recode(factor(data_UT2019$s51p1), "Si" = "1", "No" = "2" ))[2]

df_cocina_sexo_2019[1,3] + df_cocina_sexo_2019[4,3]


#summary(fct_recode(factor(data_UT2019$s51p1), "Si" = "1", "No" = "2" ))[2] == df_cocina_sexo_2019[1,3] + df_cocina_sexo_2019[4,3]

# Los vacios se deben a que la primera pregunta de la sección es ¿Participa en los quehaceres del hogar? Si la persona responde que NO, entonces se salta la sección 6 directamente (actividad fisica y transporte). 

```



# Comparaciones tiempos 2012 y 2019


```{r}
# Pregunta UT15

df_analisis_UT15_UT2012[is.na(df_analisis_UT15_UT2012)] <- 0 # Reemplazar NA por 0 para poder efectuar la suma para determinar el tiempo semanal en horas dedicado a cocinar alimentos

df_analisis_UT15_UT2012$horas_semanales_cocina <- df_analisis_UT15_UT2012$UT15A + (df_analisis_UT15_UT2012$UT15B/60) + df_analisis_UT15_UT2012$UT15C + (df_analisis_UT15_UT2012$UT15D/60)
```

```{r}
# VALIDAR
df_analisis_UT15_UT2012 %>%
  group_by(P02_factor) %>%
  summarize(suma_horas_cocina <- sum(horas_semanales_cocina))
```


En el 2012, sumando las horas en las que todas las mujeres encuestadas dedicaron a cocinar o preparar alimentos se obtiene 264798 horas semanales, mientras que para todos los hombres 27348 horas semanales. ACUMULADO DE HORAS. REVISAR LA INTERPRETACIÓN Y EL CÁLCULO.



```{r}
# VALIDAR
# PROMEDIO DE HORAS SEMANALES EN COCINAR O PREPARAR ALIMENTOS 2012
# CONSIDERAR RANGO DE EDADES
df_analisis_UT15_UT2012 %>%
  group_by(P02_factor) %>%
  summarize(promedio_horas_cocina <- mean(horas_semanales_cocina), sd_horas_cocina <- sd(horas_semanales_cocina))
```





```{r}

df_analisis_UT2019_s51p2 <- data.frame( s51p2a = as.numeric(df_analisis_UT2019$s51p2a), s51p2b = as.numeric(df_analisis_UT2019$s51p2b), s51p2c = as.numeric(df_analisis_UT2019$s51p2c), s51p2d = as.numeric(df_analisis_UT2019$s51p2d) )

df_analisis_UT2019_s51p2[is.na(df_analisis_UT2019_s51p2)] <- 0

df_analisis_UT2019$horas_semanales_cocina <- df_analisis_UT2019_s51p2$s51p2a + (df_analisis_UT2019_s51p2$s51p2b/60) + df_analisis_UT2019_s51p2$s51p2c + (df_analisis_UT2019_s51p2$s51p2d/60)



```




```{r}
# VALIDAR
# SUMA DE HORAS
df_analisis_UT2019 %>%
  group_by(s1p2_factor) %>%
  summarize(suma_horas_cocina <- sum(horas_semanales_cocina))
```


En el 2012, sumando las horas en las que todas las mujeres encuestadas dedicaron a cocinar o preparar alimentos se obtiene 111921 horas semanales, mientras que para todos los hombres 26220 horas semanales. ACUMULADO DE HORAS. REVISAR LA INTERPRETACIÓN Y EL CÁLCULO.


```{r}
# VALIDAR
# PROMEDIO DE HORAS SEMANALES EN COCINAR O PREPARAR ALIMENTOS 2019
# CONSIDERAR RANGO DE EDADES
df_analisis_UT2019 %>%
  group_by(s1p2_factor) %>%
  summarize(promedio_horas_cocina <- mean(horas_semanales_cocina), sd_horas_cocina <- sd(horas_semanales_cocina))
```




# Serie de tiempo

```{r}
# Test
tiempo <- c(2012, 2019)
h <- c(0.662504	, 1.615684	)
m <- c(6.266967	, 6.580884	)

df_ts <- data.frame(tiempo,h,m)

ggplot( df_ts, aes(x = tiempo) ) + geom_line(aes(y = h, colour = 'Hombres')) + geom_line(aes(y = m, colour = 'Mujeres')) + labs(title = "Tiempo promedio semanal en cocinar y preparar alimentos por sexo en 2012 vs 2019 (horas)")

```







Referencias

Instituto Nacional de Estadística y Censos INEC. (2013). "Metodología de la Encuesta Específica de Uso del Tiempo - 2012." Ecuador, Noviembre 2013. Recuperado de: https://www.ecuadorencifras.gob.ec//documentos/web-inec/Uso_Tiempo/Metodologia_EUT_2012.pdf

Instituto Nacional de Estadística y Censos INEC. (2012). "Encuesta específica de uso del tiempo EUT 2012" Ecuador, Noviembre 2012. Recuperado de: https://www.ecuadorencifras.gob.ec//documentos/web-inec/Uso_Tiempo/Formulario_2012.pdf

Instituto Nacional de Estadística y Censos INEC. (2012). "Encuesta específica de uso del tiempo EUT 2012" [base de datos]. Ecuador. Recuperado de: https://www.ecuadorencifras.gob.ec/uso-del-tiempo-2/#:~:text=Uso%20del%20Tiempo%20%E2%80%93%202012,y%20formulaci%C3%B3n%20de%20pol%C3%ADticas%20p%C3%BAblicas.

Instituto Nacional de Estadística y Censos INEC. (2020). "Documento metodológico de la Encuesta Nacional Multipropósito de Hogares (Seguimiento al Plan Nacional de Desarrollo)-2019" Ecuador, 2020. Recuperado de: https://www.ecuadorencifras.gob.ec/documentos/web-inec/Multiproposito/2019/201912_Metodologia_Multiproposito.pdf 

Instituto Nacional de Estadística y Censos INEC. (2019). "Encuesta Nacional Multipropósito de Hogares-Diciembre-2019" Recuperado de: https://www.ecuadorencifras.gob.ec/documentos/web-inec/Multiproposito/2019/201912_Formulario_Multiproposito.pdf


Instituto Nacional de Estadística y Censos INEC. (2020). "Guia para el usuario de base de datos. Encuesta Nacional Multipropósito de Hogares (Seguimiento al Plan Nacional de Desarrollo)" Ecuador, junio 2020. Recuperado de: https://www.ecuadorencifras.gob.ec/documentos/web-inec/Multiproposito/2019/201912_%20Guia%20de%20usuario%20BDD_Multiproposito.pdf 

Instituto Nacional de Estadística y Censos INEC. (2019). "Encuesta Nacional Multipropósito de Hogares (Seguimiento al Plan Nacional de Desarrollo)-2019" [base de datos]



























