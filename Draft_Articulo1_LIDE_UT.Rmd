---
title: "Uso del tiempo de los ecuatorianos"
author: "Christian Javier Salas Marquez"
date: "2022-03-17"
output: html_notebook
---

Work in progress :) 

Last edited: 22-03-2022

```{r}
###############################################################
####                   Librerias                           ####
###############################################################

if(!require(tidyverse)) install.packages("tidyverse", repos = "http://cran.us.r-project.org")
if(!require(haven)) install.packages("haven", repos = "http://cran.us.r-project.org")
if(!require(readr)) install.packages("readr", repos = "http://cran.us.r-project.org")

if(!require(foreign)) install.packages("foreign", repos = "http://cran.us.r-project.org")
if(!require(survey)) install.packages("survey", repos = "http://cran.us.r-project.org")
if(!require(srvyr)) install.packages("srvyr", repos = "http://cran.us.r-project.org")


```

```{r}
###############################################################
####                   Descargar los datos                 ####
###############################################################


# Base de datos 
# Le damos un nombre al url
url <- "https://github.com/christianjaviersalasmarquez/LIDE_ESPOL_Christian_Salas/raw/main/Base%20EUT%202012.zip"
# Creamos un directorio temporal
td <- tempdir()
# Creamos una carpeta temporal
tf <- tempfile(tmpdir=td, fileext = ".zip")
# Descargamos los discap en la carpeta temporal
download.file(url,tf)

```

```{r}
# Obtenemos el nombre del archivo dentro del archivo zip, lo descomprimimos (unzip), obtenemos el nombre del 
# parche, y finalmente lo cargamos
EUT2012.f.name <- unzip(tf, list=TRUE)$Name[1] # El archivo SAV de la EUT 2012 es el primero
unzip(tf, files=EUT2012.f.name, exdir=td, overwrite=TRUE)
EUT2012.f.path <- file.path(td, EUT2012.f.name)
uso_del_tiempo_2012 <- read_sav(EUT2012.f.path)
```

```{r}
#data_UT2012 <- uso_del_tiempo_2012
data_UT2012 <- data.frame(uso_del_tiempo_2012)
```

```{r}
uso_del_tiempo_2019 <- read.csv2("https://raw.githubusercontent.com/christianjaviersalasmarquez/LIDE_ESPOL_Christian_Salas/main/201912_multibdd_uso_del_tiempo.sav.csv", header = FALSE)
```

```{r}
personas_2019 <- read.csv2("https://raw.githubusercontent.com/christianjaviersalasmarquez/LIDE_ESPOL_Christian_Salas/main/201912_multibdd_personas.sav.csv", header = FALSE)
```




```{r}
header_true <- function(df) {
  names(df) <- as.character(unlist(df[1,]))
  df[-1,]
}
```

```{r}
data_UT2019 <- header_true(uso_del_tiempo_2019)

colnames(data_UT2019)[1] <- 'area'
```

```{r}
data_personas2019 <- header_true(personas_2019)

colnames(data_personas2019)[1] <- 'area'
```



En el año 2012, se ejecutó la Encuesta Específica de Uso del Tiempo, la cual tiene un tamaño muestral de 22968 viviendas, cuya población objetivo son las personas de 12 años y más. El periodo de levantamiento fue entre noviembre y diciembre de 2012.

De acuerdo con el INEC, las encuestas de uso del tiempo son importantes porque proporcionan una forma de conocer la distribución de tiempos entre hombres y mujeres. 

En el año 2019, el uso del tiempo es un módulo de la Encuesta Nacional Multipropósito de Hogares. Entre las diferencias metodológicas, en la Encuesta Nacional Multipropósito de Hogares la población objetivo abarca los hogares y personas constituidas por personas de 5 años y más. El tamaño muestral fue de 12072 viviendas. 

# 2012


## CONTEO COCINA UT15 2012


```{r}
# 2012
# EN LA SEMANA PASADA: ¿Cocinó o preparó alimentos para consumirse en el desayuno, almuerzo, merienda, entre comidas, incluyendo comidas para llevar?

UT15_2012 <- data_UT2012$UT15

UT15_2012 <- factor(UT15_2012)

#str(UT15_2012)
#class(UT15_2012)

summary(UT15_2012)

# dim(data_UT2012[1])[1] == summary(UT15_2012)[1] + summary(UT15_2012)[2] + summary(UT15_2012)[3]



```


```{r}
df_analisis_UT15_UT2012 <- data.frame(P02_factor = fct_recode(factor(data_UT2012$P02), "Hombre" = "1", "Mujer"="2") , CIUDAD = data_UT2012$CIUDAD, UT15 = data_UT2012$UT15 , UT15_factor = fct_recode(factor(data_UT2012$UT15), "Si"="1","No"="2" ), P03 = data_UT2012$P03 , UT15A = data_UT2012$UT15A, UT15B = data_UT2012$UT15B, UT15C = data_UT2012$UT15C, UT15D = data_UT2012$UT15D)

```

```{r}
# SUCCESS

df_cocina_sexo_2012 <- df_analisis_UT15_UT2012 %>%
  group_by( P02_factor , UT15_factor ) %>%
  summarize(conteo_cocina = summary( factor(UT15) ))

df_cocina_sexo_2012
# Hay 11623 hombres con NA y 10835 mujeres con NA. Sumando el total de 22458 de la pregunta UT15

```






```{r}
# Sin considerar NA values

df_cocina_sexo_2012_plot <- df_cocina_sexo_2012 %>%
  filter( UT15_factor == "Si" | UT15_factor == "No" )

ggplot(df_cocina_sexo_2012_plot, aes(x = P02_factor, y = conteo_cocina, fill =  UT15_factor)) + geom_bar(stat = 'identity', position = 'dodge')
```

```{r}
# Proporciones

#df_cocina_sexo_2012

#df_cocina_sexo_2012[1,3] + df_cocina_sexo_2012[2,3] # Total de hombres que respondieron la pregunta UT15


#df_cocina_sexo_2012[4,3] + df_cocina_sexo_2012[5,3] # Total de mujeres que respondieron la pregunta UT15


p_hombres_cocina_si_2012 <- df_cocina_sexo_2012[1,3]/(df_cocina_sexo_2012[1,3] + df_cocina_sexo_2012[2,3])

p_mujeres_cocina_si_2012 <- df_cocina_sexo_2012[4,3]/(df_cocina_sexo_2012[4,3] + df_cocina_sexo_2012[5,3] )

p_hombres_cocina_si_2012

p_mujeres_cocina_si_2012

```


En el 2012, de los hombres y mujeres que respondieron la pregunta 'En la semana pasada, ¿Cocinó o preparó alimentos...?', un 13% de los hombres respondieron que Si y un 71% de las mujeres respondieron que Si.


## TIEMPO COCINA UT15 2012

```{r}
# Pregunta UT15

df_analisis_UT15_UT2012[is.na(df_analisis_UT15_UT2012)] <- 0 # Reemplazar NA por 0 para poder efectuar la suma para determinar el tiempo semanal en horas dedicado a cocinar alimentos

df_analisis_UT15_UT2012$horas_semanales_cocina <- df_analisis_UT15_UT2012$UT15A + (df_analisis_UT15_UT2012$UT15B/60) + df_analisis_UT15_UT2012$UT15C + (df_analisis_UT15_UT2012$UT15D/60)
```




```{r}
# Promedio de horas semanales en cocinar o preparar alimentos de los ecuatorianos de 12 años en adelante en el 2012
# No se consideran los NA values porque la pregunta UT15 está dirigida a informantes de 12 años en adelante. Los NA values están conformados por los informantes que tienen menos de 12 años

df_analisis_UT15_UT2012 %>%
  filter( UT15_factor == "Si" | UT15_factor == "No" ) %>%
  group_by(P02_factor) %>%
  summarize(promedio_horas_cocina = mean(horas_semanales_cocina), sd_horas_cocina = sd(horas_semanales_cocina), suma = sum(horas_semanales_cocina), max = max(horas_semanales_cocina), min = min(horas_semanales_cocina))
```






# 2019


```{r}
#Merge de la base de datos de uso del tiempo con la de personas, para conocer información sobre la persona

df_info_personas2019 <- data.frame(id_per = data_personas2019$id_per, s1p2 = data_personas2019$s1p2, s1p3 = data_personas2019$s1p3)

df_analisis_UT2019 <- merge(df_info_personas2019, data_UT2019, by = "id_per")


```



```{r}
# df_analisis_UT2019_s51p2 es un data frame auxiliar para calcular la cantidad horas_semanales_cocina

df_analisis_UT2019_s51p2 <- data.frame( s51p2a = as.numeric(df_analisis_UT2019$s51p2a), s51p2b = as.numeric(df_analisis_UT2019$s51p2b), s51p2c = as.numeric(df_analisis_UT2019$s51p2c), s51p2d = as.numeric(df_analisis_UT2019$s51p2d) )

df_analisis_UT2019_s51p2[is.na(df_analisis_UT2019_s51p2)] <- 0

df_analisis_UT2019$horas_semanales_cocina <- df_analisis_UT2019_s51p2$s51p2a + (df_analisis_UT2019_s51p2$s51p2b/60) + df_analisis_UT2019_s51p2$s51p2c + (df_analisis_UT2019_s51p2$s51p2d/60)

```




```{r}
df_analisis_UT2019$s1p2_factor <- fct_recode(factor(df_analisis_UT2019$s1p2), "Hombre"="1","Mujer"="2" )
df_analisis_UT2019$s51p2_factor <- fct_recode(factor(df_analisis_UT2019$s51p2), "Si"="1","No"="2" ) 
```


```{r}
# Rango de edades 

edad_2019 <- as.numeric(df_analisis_UT2019$s1p3)

R_edad_2019 = length(edad_2019)
rango_edad_10_UT2019 <- rep(0,R_edad_2019)

for (i in 1:R_edad_2019) {
  
  if((edad_2019[i] >= 0 ) & (edad_2019[i] <= 11)) { rango_edad_10_UT2019[i] <- 'Edad entre 0 y 11 años' }
  else if ( (edad_2019[i] >=12  ) & (edad_2019[i] <= 19  ) ) { rango_edad_10_UT2019[i] <- 'Edad entre 12 y 19 años' }
  else if ( (edad_2019[i] >=20  ) & (edad_2019[i] <= 29  ) ) { rango_edad_10_UT2019[i] <- 'Edad entre 20 y 29 años' }
  else if ( (edad_2019[i] >=30  ) & (edad_2019[i] <= 39  ) ) { rango_edad_10_UT2019[i] <- 'Edad entre 30 y 39 años' }
  else if ( (edad_2019[i] >=40  ) & (edad_2019[i] <= 49  ) ) { rango_edad_10_UT2019[i] <- 'Edad entre 40 y 49 años' }
  else if ( (edad_2019[i] >=50  ) & (edad_2019[i] <= 59  ) ) { rango_edad_10_UT2019[i] <- 'Edad entre 50 y 59 años' }
  else if ( (edad_2019[i] >=60  ) & (edad_2019[i] <= 69  ) ) { rango_edad_10_UT2019[i] <- 'Edad entre 60 y 69 años' }
  else if ( (edad_2019[i] >=70  )) { rango_edad_10_UT2019[i] <- 'Edad mayor a 70 años' }
  
  
}

df_analisis_UT2019$rango_edad_10_UT2019 <- factor(rango_edad_10_UT2019)
```


```{r}
# Segmentador de provincias
# En la variable ciudad, el INEC maneja un código de 6 dígitos, donde el 1er y 2do dígito forman el Código de Provincia, el 3er y 4to dígito forman el Código de Cantón y el 5to y 6to dígito forman el Código de Parroquia. Por ejemplo, en el código 010150, 01 indica la provincia de Azuay, 0101 indica el cantón Cuenca y 010150 indica la parroquia 'Cuenca'


codigo_ciudad_2019 <- df_analisis_UT2019$ciudad

R_provincia_2019 <- length(codigo_ciudad_2019)
provincia_UT2019 <- rep(0, R_provincia_2019)

for (i in 1:R_provincia_2019) {
  
  if (substr(codigo_ciudad_2019[i], start = 1, stop = 2) == "01") { provincia_UT2019[i] <- 'Azuay' }
  else if (substr(codigo_ciudad_2019[i], start = 1, stop = 2) == "02") { provincia_UT2019[i] <- 'Bolívar' }
  else if (substr(codigo_ciudad_2019[i], start = 1, stop = 2) == "03") { provincia_UT2019[i] <- 'Cañar' }
  else if (substr(codigo_ciudad_2019[i], start = 1, stop = 2) == "04") { provincia_UT2019[i] <- 'Carchi' }
  else if (substr(codigo_ciudad_2019[i], start = 1, stop = 2) == "05") { provincia_UT2019[i] <- 'Cotopaxi' }
  else if (substr(codigo_ciudad_2019[i], start = 1, stop = 2) == "06") { provincia_UT2019[i] <- 'Chimborazo' }
  else if (substr(codigo_ciudad_2019[i], start = 1, stop = 2) == "07") { provincia_UT2019[i] <- 'El Oro' }
  else if (substr(codigo_ciudad_2019[i], start = 1, stop = 2) == "08") { provincia_UT2019[i] <- 'Esmeraldas' }
  else if (substr(codigo_ciudad_2019[i], start = 1, stop = 2) == "09") { provincia_UT2019[i] <- 'Guayas' }
  else if (substr(codigo_ciudad_2019[i], start = 1, stop = 2) == "10") { provincia_UT2019[i] <- 'Imbabura' }
  else if (substr(codigo_ciudad_2019[i], start = 1, stop = 2) == "11") { provincia_UT2019[i] <- 'Loja' }
  else if (substr(codigo_ciudad_2019[i], start = 1, stop = 2) == "12") { provincia_UT2019[i] <- 'Los Ríos' }
  else if (substr(codigo_ciudad_2019[i], start = 1, stop = 2) == "13") { provincia_UT2019[i] <- 'Manabí' }
  else if (substr(codigo_ciudad_2019[i], start = 1, stop = 2) == "14") { provincia_UT2019[i] <- 'Morona Santiago' }
  else if (substr(codigo_ciudad_2019[i], start = 1, stop = 2) == "15") { provincia_UT2019[i] <- 'Napo' }
  else if (substr(codigo_ciudad_2019[i], start = 1, stop = 2) == "16") { provincia_UT2019[i] <- 'Pastaza' }
  else if (substr(codigo_ciudad_2019[i], start = 1, stop = 2) == "17") { provincia_UT2019[i] <- 'Pichincha' }
  else if (substr(codigo_ciudad_2019[i], start = 1, stop = 2) == "18") { provincia_UT2019[i] <- 'Tungurahua' }
  else if (substr(codigo_ciudad_2019[i], start = 1, stop = 2) == "19") { provincia_UT2019[i] <- 'Zamora Chinchipe' }
  else if (substr(codigo_ciudad_2019[i], start = 1, stop = 2) == "20") { provincia_UT2019[i] <- 'Galápagos' }
  else if (substr(codigo_ciudad_2019[i], start = 1, stop = 2) == "21") { provincia_UT2019[i] <- 'Sucumbíos' }
  else if (substr(codigo_ciudad_2019[i], start = 1, stop = 2) == "22") { provincia_UT2019[i] <- 'Orellana' }
  else if (substr(codigo_ciudad_2019[i], start = 1, stop = 2) == "23") { provincia_UT2019[i] <- 'Santo Domingo de los Tsáchilas' }
  else if (substr(codigo_ciudad_2019[i], start = 1, stop = 2) == "24") { provincia_UT2019[i] <- 'Santa Elena' }
  else if (substr(codigo_ciudad_2019[i], start = 1, stop = 2) == "90") { provincia_UT2019[i] <- 'Zonas no delimitadas' }
  
}

df_analisis_UT2019$provincia_UT2019 <- factor(provincia_UT2019)

```




### QUEHACERES DEL HOGAR

Es importante considerar brevemente la pregunta s51p1 ¿Participa en los quehaceres de su hogar...? porque las personas que respondan que NO, omiten el resto de preguntas de la sección de uso del tiempo, la cual incluye la pregunta principal de interés s51p2 'En la semana pasada ¿Cocinó o preparó alimentos...?. Es decir, en este caso, los NA values de la variable s51p2_factor están conformados tanto por personas que NO tienen más de 12 años como por personas que responden que NO a la pregunta s51p1 omitiendo s51p2.


```{r}
# Summarize() con summary()
# Participa en quehaceres del hogar? Por sexo
df_hogar_sexo <- df_analisis_UT2019 %>%
  group_by(s1p2_factor, participacion = fct_recode(factor(s51p1), "Si" = "1", "No" = "2" )) %>%
  summarize(conteo_actividades_hogar = summary(factor(s51p1)))

df_hogar_sexo
```


De los encuestados, ¿Cuántos respondieron que sí participan en los quehaceres del hogar y cuantos no? Por sexo

```{r}
ggplot(df_hogar_sexo, aes(x = s1p2_factor, y = conteo_actividades_hogar, fill = participacion)) + geom_bar(stat = 'identity', position = 'dodge')
```

FIN DE SECCION DE QUEHACERES DEL HOGAR.








## CONTEO COCINA s51p2 2019


```{r}
# 2019
# La semana pasada... Cocinó o preparó alimentos para consumirse en el desayuno, almuerzo, merienda, entre comidas, incluyendo comidas para llevar?

df_cocina_sexo_2019 <- df_analisis_UT2019 %>%
  group_by(s1p2_factor, s51p2_factor) %>%
  summarize(conteo_cocina = summary( factor(s1p2)  ) )  #Resulta el mismo conteo si se coloca factor(s1p2) o factor(s51p2) en el summary

df_cocina_sexo_2019

```


```{r}
df_cocina_sexo_2019_plot <- df_cocina_sexo_2019 %>%
  filter(s51p2_factor == "Si" | s51p2_factor == "No")

ggplot(df_cocina_sexo_2019_plot, aes(x = s1p2_factor, y = conteo_cocina, fill = s51p2_factor)) + 
  geom_bar(stat = 'identity', position = 'dodge') + 
  labs(title = "Cocinó o preparo alimentos? Respuestas por sexo en 2019", caption = "Fuente: INEC") +
  geom_text(aes(label = conteo_cocina), color ="black", size = 3,position = position_dodge(0.9),vjust = 0) +
  theme_classic()
  
```



```{r}
# Proporciones

#df_cocina_sexo_2019[2,3]  + df_cocina_sexo_2019[3,3] # Total hombres que si participan en el hogar
#df_cocina_sexo_2019[5,3]  + df_cocina_sexo_2019[6,3] # Total mujeres que si participan en el hogar

p_hombres_cocina_si_2019 <- df_cocina_sexo_2019[2,3]/(df_cocina_sexo_2019[2,3]  + df_cocina_sexo_2019[3,3])
p_mujeres_cocina_si_2019 <- df_cocina_sexo_2019[5,3]/(df_cocina_sexo_2019[5,3]  + df_cocina_sexo_2019[6,3])

p_hombres_cocina_si_2019
p_mujeres_cocina_si_2019

```


Podemos estudiar las proporciones. En el 2019, el 54% de los hombres respondieron que si cocinó o preparó alimentos, mientras que el 89% de las mujeres respondieron que si.



```{r}
df_cocina_edad_2019 <- df_analisis_UT2019 %>%
  group_by(rango_edad_10_UT2019, s51p2_factor) %>%
  summarize( conteo_cocina = summary( factor(s51p2) ) )

df_cocina_edad_2019

df_cocina_edad_2019 %>% filter(s51p2_factor == "Si" | s51p2_factor == "No")

# Por cada grupo edad, los NA values de s51p2_factor están dados por las personas que respondieron que NO a s51p1
```







```{r}
ggplot(    df_cocina_edad_2019 %>% filter(s51p2_factor == "Si" | s51p2_factor == "No")    , aes(x = conteo_cocina, y = rango_edad_10_UT2019, fill = s51p2_factor)) + 
  geom_bar(stat = 'identity', position = 'dodge') + 
  labs(title = "Cocinó o preparo alimentos? Respuestas por grupo de edad en 2019", caption = "Fuente: INEC") +
  geom_text(aes(label = conteo_cocina), color ="black", size = 3,position = position_dodge(0.9),vjust = 0) +
  theme_classic()
  
```




## TIEMPO COCINA s51p2 2019




```{r}
# Promedio de horas semanales en cocinar o preparar alimentos en 2019 por sexo.
df_analisis_UT2019 %>%
  filter( s51p2_factor == "Si" | s51p2_factor == "No" ) %>%
  group_by(s1p2_factor) %>%
  summarize(promedio_horas_cocina = mean(horas_semanales_cocina), sd_horas_cocina = sd(horas_semanales_cocina), suma = sum(horas_semanales_cocina), max = max(horas_semanales_cocina), min = min(horas_semanales_cocina))
```





# Factores de Expansión, Unidades Primarias de Muestreo y Estratos


```{r}
# En el dataset, fexp está compuesta por valores del tipo character con coma, por lo cual R no puede transformar a numeric sin que aparezca el warning NAs introduced by coercion transformando todos los valores en NA. Primero es necesario reemplazar las comas por puntos

R_fexp <- length(df_analisis_UT2019$fexp)
fexp_UT2019 <- rep(0,R_fexp)

for (i in 1:R_fexp) {
  fexp_UT2019[i] <- gsub(",",".", df_analisis_UT2019$fexp[i])
  
}

df_analisis_UT2019$fexp_UT2019 <- as.numeric(fexp_UT2019)

```



```{r}
# Histograma de los factores de expansión de UT2019


ggplot(df_analisis_UT2019, aes(x = fexp_UT2019)) +  geom_histogram()

```


```{r}
df_analisis_UT2019$upm_factor <- factor(df_analisis_UT2019$upm)
df_analisis_UT2019$estrato_factor <- factor(df_analisis_UT2019$estrato)
```



```{r}
# Declaración del diseño muestral de la encuesta multipropósito
d_multiproposito2019 <- df_analisis_UT2019 %>% as_survey_design(ids = upm_factor,
 strata = estrato_factor,
 weights = fexp_UT2019,
 nest = T) # Especifica los estratos y los conglomerados que se presentan en el diseño muestral de la encuesta
options(survey.lonely.psu="certainty")
```





```{r}
# Cálculos
#d_multiproposito2019 %>%
#summarise(tdesem = survey_mean(tdeso, vartype=c("se","ci","cv"), na.rm=T, deff = T))

#d_multiproposito2019 %>%
#group_by(NDOMINIO)%>%
#summarise(tdesem = survey_mean(tdeso, vartype=c("se","ci","cv"), na.rm=T, deff = T)) 
```



Referencias

Instituto Nacional de Estadística y Censos INEC. (2013). "Metodología de la Encuesta Específica de Uso del Tiempo - 2012." Ecuador, Noviembre 2013. Recuperado de: https://www.ecuadorencifras.gob.ec//documentos/web-inec/Uso_Tiempo/Metodologia_EUT_2012.pdf

Instituto Nacional de Estadística y Censos INEC. (2012). "Encuesta específica de uso del tiempo EUT 2012" Ecuador, Noviembre 2012. Recuperado de: https://www.ecuadorencifras.gob.ec//documentos/web-inec/Uso_Tiempo/Formulario_2012.pdf

Instituto Nacional de Estadística y Censos INEC. (2012). "Encuesta específica de uso del tiempo EUT 2012" [base de datos]. Ecuador. Recuperado de: https://www.ecuadorencifras.gob.ec/uso-del-tiempo-2/#:~:text=Uso%20del%20Tiempo%20%E2%80%93%202012,y%20formulaci%C3%B3n%20de%20pol%C3%ADticas%20p%C3%BAblicas.

Instituto Nacional de Estadística y Censos INEC. (2020). "Documento metodológico de la Encuesta Nacional Multipropósito de Hogares (Seguimiento al Plan Nacional de Desarrollo)-2019" Ecuador, 2020. Recuperado de: https://www.ecuadorencifras.gob.ec/documentos/web-inec/Multiproposito/2019/201912_Metodologia_Multiproposito.pdf 

Instituto Nacional de Estadística y Censos INEC. (2019). "Encuesta Nacional Multipropósito de Hogares-Diciembre-2019" Recuperado de: https://www.ecuadorencifras.gob.ec/documentos/web-inec/Multiproposito/2019/201912_Formulario_Multiproposito.pdf


Instituto Nacional de Estadística y Censos INEC. (2020). "Guia para el usuario de base de datos. Encuesta Nacional Multipropósito de Hogares (Seguimiento al Plan Nacional de Desarrollo)" Ecuador, junio 2020. Recuperado de: https://www.ecuadorencifras.gob.ec/documentos/web-inec/Multiproposito/2019/201912_%20Guia%20de%20usuario%20BDD_Multiproposito.pdf 

Instituto Nacional de Estadística y Censos INEC. (2019). "Encuesta Nacional Multipropósito de Hogares (Seguimiento al Plan Nacional de Desarrollo)-2019" [base de datos]



























